<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Manchester — Industrial Legacy. Modern Power.</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Barlow+Condensed:wght@300;400;600&family=Barlow:wght@300;400&display=swap');

  *,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}

  :root {
    --blue: #00b4ff;
    --blue-dim: #0066aa;
    --green: #00ff88;
    --green-dim: #00aa55;
    --dark: #050810;
    --charcoal: #0d1117;
    --glass: rgba(255,255,255,0.04);
    --glass-border: rgba(255,255,255,0.08);
    --text: #e8edf5;
    --text-dim: #6b7a99;
  }

  html { scroll-behavior: smooth; overflow-x: hidden; }

  body {
    background: var(--dark);
    color: var(--text);
    font-family: 'Barlow', sans-serif;
    overflow-x: hidden;
    cursor: none;
  }

  /* Custom cursor */
  #cursor {
    position: fixed; top:0; left:0; width:12px; height:12px;
    background: var(--blue); border-radius:50%;
    pointer-events:none; z-index:9999;
    transition: transform 0.1s ease;
    mix-blend-mode: screen;
    transform: translate(-50%,-50%);
  }
  #cursor-ring {
    position:fixed; top:0; left:0; width:36px; height:36px;
    border:1px solid rgba(0,180,255,0.4); border-radius:50%;
    pointer-events:none; z-index:9998;
    transform:translate(-50%,-50%);
    transition: transform 0.18s ease, width 0.2s, height 0.2s;
  }

  /* NAV */
  nav {
    position:fixed; top:0; left:0; right:0; z-index:100;
    padding:28px 60px;
    display:flex; align-items:center; justify-content:space-between;
    background: linear-gradient(to bottom, rgba(5,8,16,0.95) 0%, transparent 100%);
    pointer-events:none;
  }
  .nav-logo {
    font-family:'Bebas Neue',cursive; font-size:1.3rem; letter-spacing:0.2em;
    color: var(--blue); text-shadow: 0 0 20px rgba(0,180,255,0.5);
    pointer-events:all;
  }
  .nav-items {
    display:flex; gap:36px; pointer-events:all;
  }
  .nav-items a {
    font-family:'Barlow Condensed',sans-serif; font-size:0.75rem; letter-spacing:0.18em;
    text-transform:uppercase; color: var(--text-dim); text-decoration:none;
    transition:color 0.3s;
  }
  .nav-items a:hover { color:var(--blue); }

  /* PROGRESS BAR */
  #progress {
    position:fixed; top:0; left:0; height:2px; z-index:200;
    background: linear-gradient(90deg, var(--blue), var(--green));
    width:0%; transition: width 0.1s linear;
    box-shadow: 0 0 8px var(--blue);
  }

  /* SECTION BASE */
  section {
    position:relative; min-height:100vh;
    display:flex; align-items:center; justify-content:center;
    overflow:hidden;
  }

  canvas.section-canvas {
    position:absolute; inset:0; width:100%; height:100%;
    display:block;
  }

  .section-content {
    position:relative; z-index:10;
    text-align:center; padding:40px 20px;
  }

  /* Glass panels */
  .glass-panel {
    background: rgba(13,17,23,0.65);
    border:1px solid var(--glass-border);
    backdrop-filter: blur(20px);
    border-radius:2px;
    padding:44px 56px;
    position:relative;
    max-width:780px;
    margin:0 auto;
    opacity:0;
    transform:translateY(40px);
    transition: opacity 0.9s ease, transform 0.9s ease;
  }
  .glass-panel::before {
    content:''; position:absolute;
    top:0; left:0; right:0; height:1px;
    background: linear-gradient(90deg, transparent, var(--blue), transparent);
  }
  .glass-panel.visible { opacity:1; transform:translateY(0); }

  /* HERO */
  #hero { min-height:100vh; }
  .hero-title {
    font-family:'Bebas Neue',cursive;
    font-size:clamp(4rem,9vw,9rem);
    line-height:0.92;
    letter-spacing:0.04em;
    color:#fff;
    text-shadow: 0 0 60px rgba(0,180,255,0.25);
    opacity:0; transform:translateY(60px);
    transition: opacity 1.2s ease 0.4s, transform 1.2s ease 0.4s;
  }
  .hero-title span { color:var(--blue); }
  .hero-sub {
    font-family:'Barlow Condensed',sans-serif;
    font-size:clamp(0.85rem,1.5vw,1.1rem);
    letter-spacing:0.35em;
    text-transform:uppercase;
    color:var(--text-dim);
    margin-top:18px;
    opacity:0; transform:translateY(30px);
    transition: opacity 1.2s ease 0.8s, transform 1.2s ease 0.8s;
  }
  .hero-title.visible, .hero-sub.visible { opacity:1; transform:translateY(0); }

  .scroll-hint {
    position:absolute; bottom:40px; left:50%; transform:translateX(-50%);
    display:flex; flex-direction:column; align-items:center; gap:8px;
    font-family:'Barlow Condensed',sans-serif; font-size:0.7rem;
    letter-spacing:0.25em; text-transform:uppercase; color:var(--text-dim);
    animation: pulse-hint 2.5s ease infinite;
    z-index:10;
  }
  .scroll-line {
    width:1px; height:50px;
    background: linear-gradient(to bottom, var(--blue), transparent);
    animation: scroll-line 2.5s ease infinite;
  }
  @keyframes pulse-hint { 0%,100%{opacity:0.4} 50%{opacity:1} }
  @keyframes scroll-line { 0%{transform:scaleY(0);transform-origin:top} 50%{transform:scaleY(1);transform-origin:top} 51%{transform:scaleY(1);transform-origin:bottom} 100%{transform:scaleY(0);transform-origin:bottom} }

  /* Section labels */
  .section-label {
    font-family:'Barlow Condensed',sans-serif;
    font-size:0.65rem; letter-spacing:0.4em; text-transform:uppercase;
    color:var(--blue); margin-bottom:18px;
    display:block;
  }
  .section-title {
    font-family:'Bebas Neue',cursive;
    font-size:clamp(2.8rem,5vw,5.5rem);
    line-height:1; letter-spacing:0.06em;
    color:#fff; margin-bottom:28px;
  }
  .section-body {
    font-family:'Barlow',sans-serif; font-weight:300;
    font-size:clamp(0.9rem,1.4vw,1.1rem);
    line-height:1.8; color: rgba(232,237,245,0.75);
    max-width:560px; margin:0 auto;
  }

  /* Tags */
  .tag-row {
    display:flex; flex-wrap:wrap; gap:14px; justify-content:center;
    margin-top:32px;
  }
  .tag {
    font-family:'Barlow Condensed',sans-serif;
    font-size:0.75rem; letter-spacing:0.2em; text-transform:uppercase;
    padding:10px 22px;
    border:1px solid var(--glass-border);
    background: rgba(0,180,255,0.06);
    color:var(--blue);
    border-radius:1px;
    cursor:default;
    transition: background 0.3s, border-color 0.3s, box-shadow 0.3s;
  }
  .tag:hover {
    background:rgba(0,180,255,0.12);
    border-color:var(--blue);
    box-shadow:0 0 18px rgba(0,180,255,0.2);
  }

  /* Dividers */
  .h-line {
    width:60px; height:1px;
    background: linear-gradient(90deg, var(--blue), var(--green));
    margin:28px auto;
    box-shadow:0 0 6px var(--blue);
  }

  /* Stat grid */
  .stat-grid {
    display:grid; grid-template-columns:repeat(3,1fr); gap:1px;
    margin-top:36px;
    border:1px solid var(--glass-border);
  }
  .stat-cell {
    padding:24px 20px; text-align:center;
    background:rgba(0,180,255,0.03);
    border:1px solid var(--glass-border);
  }
  .stat-num {
    font-family:'Bebas Neue',cursive; font-size:2.8rem;
    color:var(--blue); line-height:1;
    text-shadow:0 0 20px rgba(0,180,255,0.4);
  }
  .stat-lbl {
    font-family:'Barlow Condensed',sans-serif;
    font-size:0.65rem; letter-spacing:0.25em; text-transform:uppercase;
    color:var(--text-dim); margin-top:6px;
  }

  /* Sound wave bars */
  .wave-bars {
    display:flex; align-items:flex-end; justify-content:center;
    gap:4px; height:60px; margin-top:30px;
  }
  .bar {
    width:4px; background:linear-gradient(to top,var(--blue),var(--green));
    border-radius:2px;
    animation: bar-anim 1.2s ease infinite;
  }
  @keyframes bar-anim {
    0%,100%{height:8px;opacity:0.4}
    50%{height:var(--h,30px);opacity:1}
  }

  /* Stadium section */
  #football .section-title { color:#fff; }

  /* Final section */
  #finale { background: radial-gradient(ellipse at 50% 100%, rgba(0,100,50,0.15), transparent 60%); }
  .finale-title {
    font-family:'Bebas Neue',cursive;
    font-size:clamp(3rem,6vw,7rem);
    line-height:1; letter-spacing:0.04em;
    color:#fff;
    text-shadow: 0 0 80px rgba(0,255,136,0.2), 0 0 40px rgba(0,180,255,0.15);
  }
  .finale-sub {
    font-family:'Barlow Condensed',sans-serif; font-weight:300;
    font-size:1.05rem; letter-spacing:0.25em; text-transform:uppercase;
    color:var(--green); margin-top:18px; opacity:0.8;
  }

  /* Neon glow text */
  .glow-blue { color:var(--blue); text-shadow: 0 0 30px rgba(0,180,255,0.5); }
  .glow-green { color:var(--green); text-shadow: 0 0 30px rgba(0,255,136,0.4); }

  /* Parallax bg overlays */
  .gradient-overlay {
    position:absolute; inset:0; z-index:1; pointer-events:none;
  }

  /* Scanlines overlay */
  .scanlines {
    position:fixed; inset:0; z-index:50; pointer-events:none;
    background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.03) 2px, rgba(0,0,0,0.03) 4px);
  }

  /* Particle canvas */
  #particle-canvas {
    position:fixed; inset:0; z-index:2; pointer-events:none;
    opacity:0.5;
  }

  /* Section 2 warm overlay */
  #industrial .gradient-overlay {
    background: linear-gradient(to top, rgba(80,30,0,0.3), transparent);
  }

  @media(max-width:768px){
    nav { padding:20px 24px; }
    .nav-items { display:none; }
    .glass-panel { padding:30px 24px; }
    .stat-grid { grid-template-columns:repeat(3,1fr); }
  }

  /* ═══════════════════════════════════════════════════
     EXPLORE BUTTONS
  ═══════════════════════════════════════════════════ */
  .explore-btn {
    display: inline-flex; align-items: center; gap: 10px;
    margin-top: 32px;
    padding: 14px 36px;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.8rem; letter-spacing: 0.3em; text-transform: uppercase;
    color: var(--blue);
    border: 1px solid var(--blue);
    background: transparent;
    cursor: pointer;
    position: relative; overflow: hidden;
    transition: color 0.3s, box-shadow 0.3s;
    z-index: 1;
  }
  .explore-btn::before {
    content: '';
    position: absolute; inset: 0;
    background: var(--blue);
    transform: scaleX(0); transform-origin: left;
    transition: transform 0.4s cubic-bezier(0.4,0,0.2,1);
    z-index: -1;
  }
  .explore-btn:hover::before { transform: scaleX(1); }
  .explore-btn:hover { color: #000; box-shadow: 0 0 30px rgba(0,180,255,0.5); }
  .explore-btn .btn-arrow {
    transition: transform 0.3s;
  }
  .explore-btn:hover .btn-arrow { transform: translateX(5px); }

  .explore-btn.warm { color: #ff8800; border-color: #ff8800; }
  .explore-btn.warm::before { background: #ff8800; }
  .explore-btn.warm:hover { box-shadow: 0 0 30px rgba(255,136,0,0.5); }

  .explore-btn.green { color: var(--green); border-color: var(--green); }
  .explore-btn.green::before { background: var(--green); }
  .explore-btn.green:hover { box-shadow: 0 0 30px rgba(0,255,136,0.5); }

  .explore-btn.purple { color: #cc88ff; border-color: #cc88ff; }
  .explore-btn.purple::before { background: #cc88ff; }
  .explore-btn.purple:hover { box-shadow: 0 0 30px rgba(200,136,255,0.5); }

  /* ═══════════════════════════════════════════════════
     MODAL OVERLAY
  ═══════════════════════════════════════════════════ */
  #modal-overlay {
    position: fixed; inset: 0; z-index: 1000;
    background: rgba(0,0,0,0);
    backdrop-filter: blur(0px);
    display: flex; align-items: center; justify-content: center;
    pointer-events: none;
    transition: background 0.5s ease, backdrop-filter 0.5s ease;
  }
  #modal-overlay.active {
    background: rgba(0,0,6,0.88);
    backdrop-filter: blur(12px);
    pointer-events: all;
  }

  /* ═══════════════════════════════════════════════════
     MODAL BOX
  ═══════════════════════════════════════════════════ */
  .modal-box {
    position: relative;
    width: min(880px, 94vw);
    max-height: 90vh;
    overflow-y: auto;
    overflow-x: hidden;
    background: rgba(8,12,22,0.97);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 4px;
    scrollbar-width: thin;
    scrollbar-color: rgba(0,180,255,0.3) transparent;
    opacity: 0;
    transform: scale(0.8) translateY(40px);
    transition: opacity 0.5s cubic-bezier(0.16,1,0.3,1), transform 0.5s cubic-bezier(0.16,1,0.3,1);
  }
  .modal-box::-webkit-scrollbar { width: 4px; }
  .modal-box::-webkit-scrollbar-track { background: transparent; }
  .modal-box::-webkit-scrollbar-thumb { background: rgba(0,180,255,0.3); border-radius: 2px; }

  #modal-overlay.active .modal-box {
    opacity: 1;
    transform: scale(1) translateY(0);
  }

  /* TOP ACCENT LINE */
  .modal-box::before {
    content: '';
    position: absolute; top: 0; left: 0; right: 0; height: 2px;
    background: var(--modal-accent, linear-gradient(90deg, #00b4ff, #00ff88));
    box-shadow: 0 0 20px rgba(0,180,255,0.6);
    z-index: 2;
  }

  /* ── MODAL HEADER ── */
  .modal-header {
    position: relative;
    padding: 0;
    overflow: hidden;
    min-height: 220px;
    display: flex; align-items: flex-end;
  }
  .modal-header-bg {
    position: absolute; inset: 0;
    z-index: 0;
  }
  .modal-header-canvas {
    width: 100%; height: 100%;
    display: block;
  }
  .modal-header-overlay {
    position: absolute; inset: 0;
    background: linear-gradient(to top, rgba(8,12,22,1) 0%, transparent 60%);
    z-index: 1;
  }
  .modal-header-content {
    position: relative; z-index: 2;
    padding: 28px 40px 32px;
    width: 100%;
  }
  .modal-emoji-big {
    font-size: 3rem; line-height: 1;
    display: block; margin-bottom: 10px;
    animation: emoji-float 3s ease-in-out infinite;
  }
  @keyframes emoji-float {
    0%,100% { transform: translateY(0) rotate(-3deg); }
    50% { transform: translateY(-8px) rotate(3deg); }
  }
  .modal-eyebrow {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.65rem; letter-spacing: 0.4em; text-transform: uppercase;
    color: var(--accent-col, var(--blue));
    margin-bottom: 8px;
    display: block;
  }
  .modal-title {
    font-family: 'Bebas Neue', cursive;
    font-size: clamp(2.2rem, 5vw, 4rem);
    line-height: 0.95;
    color: #fff;
    letter-spacing: 0.04em;
  }
  .modal-title .accent { color: var(--accent-col, var(--blue)); }

  /* ── CLOSE BUTTON ── */
  .modal-close {
    position: absolute; top: 20px; right: 20px; z-index: 10;
    width: 40px; height: 40px;
    border: 1px solid rgba(255,255,255,0.15);
    background: rgba(255,255,255,0.05);
    color: #fff; font-size: 1.2rem;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; border-radius: 50%;
    transition: background 0.3s, transform 0.3s, border-color 0.3s;
  }
  .modal-close:hover {
    background: rgba(255,50,50,0.2);
    border-color: rgba(255,50,50,0.5);
    transform: rotate(90deg) scale(1.1);
  }

  /* ── MODAL BODY ── */
  .modal-body {
    padding: 0 40px 40px;
  }

  /* ── INTRO TEXT ── */
  .modal-intro {
    font-family: 'Barlow', sans-serif; font-weight: 300;
    font-size: clamp(0.95rem, 1.5vw, 1.05rem); line-height: 1.9;
    color: rgba(232,237,245,0.8);
    margin-bottom: 32px;
    border-left: 2px solid var(--accent-col, var(--blue));
    padding-left: 20px;
  }

  /* ── FACT CARDS GRID ── */
  .modal-cards {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 14px; margin-bottom: 32px;
  }
  .modal-card {
    background: rgba(255,255,255,0.03);
    border: 1px solid rgba(255,255,255,0.07);
    border-radius: 2px;
    padding: 20px 18px;
    position: relative; overflow: hidden;
    opacity: 0; transform: translateY(20px);
    transition: opacity 0.4s ease, transform 0.4s ease, background 0.3s;
  }
  .modal-card:hover {
    background: rgba(255,255,255,0.06);
    border-color: var(--accent-col, var(--blue));
  }
  .modal-card::before {
    content: '';
    position: absolute; top: 0; left: 0; right: 0; height: 1px;
    background: linear-gradient(90deg, transparent, var(--accent-col, var(--blue)), transparent);
    opacity: 0.5;
  }
  .modal-card.visible { opacity: 1; transform: translateY(0); }
  .modal-card-emoji { font-size: 1.6rem; margin-bottom: 8px; display: block; }
  .modal-card-value {
    font-family: 'Bebas Neue', cursive;
    font-size: 2rem; line-height: 1;
    color: var(--accent-col, var(--blue));
    text-shadow: 0 0 20px var(--accent-col, rgba(0,180,255,0.5));
  }
  .modal-card-label {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.7rem; letter-spacing: 0.2em; text-transform: uppercase;
    color: var(--text-dim); margin-top: 4px;
  }
  .modal-card-desc {
    font-family: 'Barlow', sans-serif; font-weight: 300;
    font-size: 0.8rem; line-height: 1.6;
    color: rgba(232,237,245,0.6); margin-top: 8px;
  }

  /* ── TIMELINE ── */
  .modal-timeline {
    position: relative; margin-bottom: 32px; padding-left: 24px;
  }
  .modal-timeline::before {
    content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 1px;
    background: linear-gradient(to bottom, var(--accent-col, var(--blue)), transparent);
  }
  .timeline-item {
    position: relative; margin-bottom: 22px;
    opacity: 0; transform: translateX(-15px);
    transition: opacity 0.4s ease, transform 0.4s ease;
  }
  .timeline-item.visible { opacity: 1; transform: translateX(0); }
  .timeline-item::before {
    content: '';
    position: absolute; left: -28px; top: 6px;
    width: 8px; height: 8px; border-radius: 50%;
    background: var(--accent-col, var(--blue));
    box-shadow: 0 0 10px var(--accent-col, rgba(0,180,255,0.8));
  }
  .timeline-year {
    font-family: 'Bebas Neue', cursive;
    font-size: 1.2rem; color: var(--accent-col, var(--blue));
    letter-spacing: 0.1em;
  }
  .timeline-text {
    font-family: 'Barlow', sans-serif; font-weight: 300;
    font-size: 0.85rem; line-height: 1.6;
    color: rgba(232,237,245,0.75);
  }

  /* ── NEON TAGS ── */
  .modal-tags {
    display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 28px;
  }
  .modal-tag {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.7rem; letter-spacing: 0.2em; text-transform: uppercase;
    padding: 8px 16px;
    border-radius: 20px;
    border: 1px solid;
    background: transparent;
    transition: transform 0.2s, box-shadow 0.2s;
    cursor: default;
  }
  .modal-tag:hover { transform: scale(1.05); }

  /* ── COLORFUL TEXT SECTION ── */
  .modal-rainbow-title {
    font-family: 'Bebas Neue', cursive;
    font-size: clamp(1.5rem, 3vw, 2.5rem);
    letter-spacing: 0.05em;
    background: linear-gradient(90deg, #ff6b6b, #ffd93d, #6bcb77, #4d96ff, #cc44ff);
    background-size: 200% 100%;
    -webkit-background-clip: text; background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: rainbow-shift 4s linear infinite;
    margin-bottom: 14px;
  }
  @keyframes rainbow-shift {
    0% { background-position: 0% 50%; }
    100% { background-position: 200% 50%; }
  }

  /* ── QUOTE BLOCK ── */
  .modal-quote {
    margin: 24px 0;
    padding: 20px 24px;
    border-left: 3px solid var(--accent-col, var(--blue));
    background: rgba(255,255,255,0.02);
    font-family: 'Barlow Condensed', sans-serif;
    font-size: clamp(1rem, 2vw, 1.3rem);
    font-style: italic; line-height: 1.5;
    color: rgba(232,237,245,0.9);
    letter-spacing: 0.02em;
  }
  .modal-quote-author {
    margin-top: 10px;
    font-size: 0.75rem; letter-spacing: 0.2em;
    color: var(--accent-col, var(--blue)); text-transform: uppercase;
    font-style: normal;
  }

  /* ── FLOATING EMOJI BURST ── */
  .emoji-burst {
    position: fixed; pointer-events: none; z-index: 2000;
    font-size: 1.8rem;
    animation: burst-out 1.2s ease forwards;
  }
  @keyframes burst-out {
    0% { opacity: 1; transform: translate(0,0) scale(1); }
    100% { opacity: 0; transform: translate(var(--dx,0),var(--dy,-60px)) scale(0.5); }
  }

  /* ── MODAL MINI 3D CANVAS ── */
  .modal-3d-container {
    width: 100%; height: 200px;
    position: relative; border-radius: 2px; overflow: hidden;
    margin-bottom: 28px;
    border: 1px solid rgba(255,255,255,0.06);
  }
  .modal-3d-container canvas {
    width: 100%; height: 100%; display: block;
  }
  .modal-3d-label {
    position: absolute; bottom: 10px; right: 14px; z-index: 2;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.6rem; letter-spacing: 0.3em; text-transform: uppercase;
    color: rgba(255,255,255,0.3);
  }

  /* ── PROGRESS BARS ── */
  .modal-progress-list { margin-bottom: 28px; }
  .progress-item { margin-bottom: 16px; }
  .progress-label-row {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 6px;
  }
  .progress-name {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.75rem; letter-spacing: 0.15em; text-transform: uppercase;
    color: rgba(232,237,245,0.8);
  }
  .progress-value {
    font-family: 'Bebas Neue', cursive;
    font-size: 0.9rem; color: var(--accent-col, var(--blue));
  }
  .progress-track {
    height: 3px; background: rgba(255,255,255,0.06); border-radius: 2px;
    overflow: hidden;
  }
  .progress-fill {
    height: 100%; width: 0%;
    background: linear-gradient(90deg, var(--accent-col, var(--blue)), var(--accent-col2, var(--green)));
    border-radius: 2px;
    box-shadow: 0 0 8px var(--accent-col, rgba(0,180,255,0.5));
    transition: width 1.2s cubic-bezier(0.4,0,0.2,1);
  }

  /* ── DIVIDER ── */
  .modal-divider {
    height: 1px; margin: 28px 0;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.08), transparent);
  }

  /* ── SECTION COLOR THEMES ── */
  [data-modal="industrial"] { --accent-col: #ff8800; --accent-col2: #ffb347; }
  [data-modal="economy"] { --accent-col: #00b4ff; --accent-col2: #00ff88; }
  [data-modal="education"] { --accent-col: #00ff88; --accent-col2: #00b4ff; }
  [data-modal="football"] { --accent-col: #ffffff; --accent-col2: #00ff88; }
  [data-modal="culture"] { --accent-col: #cc88ff; --accent-col2: #ff66cc; }
  [data-modal="hero"] { --accent-col: #00b4ff; --accent-col2: #cc88ff; }

</style>
</head>
<body>

<!-- ═══════════════════════════════════════════════════════════
     MODAL OVERLAY SYSTEM
════════════════════════════════════════════════════════════ -->
<div id="modal-overlay">
  <div class="modal-box" id="modal-box">
    <button class="modal-close" id="modal-close" aria-label="Close">✕</button>
    <!-- Dynamic content injected by JS -->
    <div id="modal-inner"></div>
  </div>
</div>



<div id="cursor"></div>
<div id="cursor-ring"></div>
<div id="progress"></div>
<div class="scanlines"></div>
<canvas id="particle-canvas"></canvas>

<nav>
  <div class="nav-logo">MCR</div>
  <div class="nav-items">
    <a href="#hero">Origin</a>
    <a href="#industrial">Industry</a>
    <a href="#economy">Economy</a>
    <a href="#education">Innovation</a>
    <a href="#football">Football</a>
    <a href="#culture">Culture</a>
  </div>
</nav>

<!-- SECTION 1: HERO -->
<section id="hero">
  <canvas class="section-canvas" id="hero-canvas"></canvas>
  <div class="gradient-overlay" style="background:linear-gradient(to bottom,transparent 40%,var(--dark) 100%)"></div>
  <div class="section-content">
    <div class="hero-title" id="hero-title">
      MAN<span>CHESTER</span><br>
      Industrial Legacy.<br>Modern Power.
    </div>
    <div class="hero-sub" id="hero-sub">53.4808° N, 2.2426° W — England</div>
    <button class="explore-btn" onclick="openModal('hero', this)" style="margin-top:28px;">
      Discover MCR <span class="btn-arrow">→</span>
    </button>
  </div>
  <div class="scroll-hint">
    <div class="scroll-line"></div>
    Scroll to Explore
  </div>
</section>

<!-- SECTION 2: INDUSTRIAL REVOLUTION -->
<section id="industrial">
  <canvas class="section-canvas" id="industrial-canvas"></canvas>
  <div class="gradient-overlay" style="background:linear-gradient(to top,rgba(60,20,0,0.4),transparent)"></div>
  <div class="gradient-overlay" style="background:linear-gradient(to bottom,var(--dark) 0%,transparent 15%,transparent 85%,var(--dark) 100%)"></div>
  <div class="section-content">
    <div class="glass-panel" id="panel-industrial">
      <span class="section-label">1760 — 1850</span>
      <div class="section-title" style="color:#ffb347;">The <span style="color:#ff8800;">Cottonopolis</span></div>
      <div class="h-line" style="background:linear-gradient(90deg,#ff8800,#ffb347);box-shadow:0 0 8px #ff8800;"></div>
      <p class="section-body">
        Manchester became the world's first industrial city — a crucible of transformation where steam, cotton, and human ambition forged the modern age. The mills that lined the Irwell shaped the global economy.
      </p>
      <div class="stat-grid" style="margin-top:32px;">
        <div class="stat-cell">
          <div class="stat-num" style="color:#ff8800;">1781</div>
          <div class="stat-lbl">Bridgewater Canal</div>
        </div>
        <div class="stat-cell">
          <div class="stat-num" style="color:#ff8800;">50+</div>
          <div class="stat-lbl">Cotton Mills by 1800</div>
        </div>
        <div class="stat-cell">
          <div class="stat-num" style="color:#ff8800;">1st</div>
          <div class="stat-lbl">Industrial City</div>
        </div>
      
      <div style="text-align:center;margin-top:8px;">
        <button class="explore-btn warm" onclick="openModal('industrial', this)">
          The Full Story <span class="btn-arrow">→</span>
        </button>
      </div>
    </div>
  </div>
</section>

<!-- SECTION 3: MODERN ECONOMY -->
<section id="economy">
  <canvas class="section-canvas" id="economy-canvas"></canvas>
  <div class="gradient-overlay" style="background:linear-gradient(to bottom,var(--dark) 0%,transparent 12%,transparent 88%,var(--dark) 100%)"></div>
  <div class="section-content">
    <div class="glass-panel" id="panel-economy">
      <span class="section-label">Modern Era — Present</span>
      <div class="section-title">The New <span class="glow-blue">Digital</span> North</div>
      <div class="h-line"></div>
      <p class="section-body">
        The second-largest financial and professional services hub in the UK, Manchester anchors the Northern Powerhouse — drawing global talent, capital, and ambition.
      </p>
      <div class="tag-row">
        <div class="tag">Finance</div>
        <div class="tag">Technology</div>
        <div class="tag">Media City</div>
        <div class="tag">Innovation</div>
        <div class="tag">Life Sciences</div>
        <div class="tag">Digital Arts</div>
      </div>
      <div class="stat-grid">
        <div class="stat-cell">
          <div class="stat-num">£80B</div>
          <div class="stat-lbl">Regional Economy</div>
        </div>
        <div class="stat-cell">
          <div class="stat-num">2.9M</div>
          <div class="stat-lbl">City Region Population</div>
        </div>
        <div class="stat-cell">
          <div class="stat-num">7%</div>
          <div class="stat-lbl">Annual Growth</div>
        </div>
      
      <div style="text-align:center;margin-top:8px;">
        <button class="explore-btn" onclick="openModal('economy', this)">
          Explore Economy <span class="btn-arrow">→</span>
        </button>
      </div>
    </div>
  </div>
</section>

<!-- SECTION 4: EDUCATION & INNOVATION -->
<section id="education">
  <canvas class="section-canvas" id="education-canvas"></canvas>
  <div class="gradient-overlay" style="background:linear-gradient(to bottom,var(--dark) 0%,transparent 12%,transparent 88%,var(--dark) 100%)"></div>
  <div class="section-content">
    <div class="glass-panel" id="panel-education">
      <span class="section-label" style="color:var(--green);">Research & Discovery</span>
      <div class="section-title">Where Science <span class="glow-green">Begins</span></div>
      <div class="h-line" style="background:linear-gradient(90deg,var(--green),var(--blue));"></div>
      <p class="section-body">
        Home to one of the world's leading research institutions and the birthplace of graphene — the world's first two-dimensional material. Manchester has produced 25 Nobel Laureates across disciplines.
      </p>
      <div class="stat-grid">
        <div class="stat-cell">
          <div class="stat-num" style="color:var(--green);">25</div>
          <div class="stat-lbl">Nobel Laureates</div>
        </div>
        <div class="stat-cell">
          <div class="stat-num" style="color:var(--green);">2004</div>
          <div class="stat-lbl">Graphene Discovered</div>
        </div>
        <div class="stat-cell">
          <div class="stat-num" style="color:var(--green);">Top 5</div>
          <div class="stat-lbl">UK Research Output</div>
        </div>
      
      <div style="text-align:center;margin-top:8px;">
        <button class="explore-btn green" onclick="openModal('education', this)">
          Science & Discovery <span class="btn-arrow">→</span>
        </button>
      </div>
    </div>
  </div>
</section>

<!-- SECTION 5: FOOTBALL -->
<section id="football">
  <canvas class="section-canvas" id="football-canvas"></canvas>
  <div class="gradient-overlay" style="background:linear-gradient(to bottom,var(--dark) 0%,transparent 12%,transparent 88%,var(--dark) 100%)"></div>
  <div class="section-content">
    <div class="glass-panel" id="panel-football">
      <span class="section-label" style="color:#ffffff99;">The Beautiful Game</span>
      <div class="section-title" style="font-size:clamp(3rem,6vw,7rem);">A Global<br><span class="glow-green">Football</span> Capital</div>
      <div class="h-line" style="background:linear-gradient(90deg,var(--green),#fff);"></div>
      <p class="section-body">
        Two of the most storied clubs in world football call this city home. From the Theatre of Dreams to the Etihad, Manchester pulses with football identity recognised on every continent.
      </p>
      <div class="stat-grid">
        <div class="stat-cell">
          <div class="stat-num" style="color:#e8edf5;">20+</div>
          <div class="stat-lbl">League Titles Combined</div>
        </div>
        <div class="stat-cell">
          <div class="stat-num" style="color:#e8edf5;">74k</div>
          <div class="stat-lbl">Old Trafford Capacity</div>
        </div>
        <div class="stat-cell">
          <div class="stat-num" style="color:#e8edf5;">1M+</div>
          <div class="stat-lbl">Global Supporters</div>
        </div>
      
      <div style="text-align:center;margin-top:8px;">
        <button class="explore-btn" style="color:#fff;border-color:#fff;" onclick="openModal('football', this)">
          The Beautiful Game <span class="btn-arrow">→</span>
        </button>
      </div>
    </div>
  </div>
</section>

<!-- SECTION 6: CULTURE & MUSIC -->
<section id="culture">
  <canvas class="section-canvas" id="culture-canvas"></canvas>
  <div class="gradient-overlay" style="background:linear-gradient(to bottom,var(--dark) 0%,transparent 12%,transparent 88%,var(--dark) 100%)"></div>
  <div class="section-content">
    <div class="glass-panel" id="panel-culture">
      <span class="section-label" style="color:#cc88ff;">Culture & Sound</span>
      <div class="section-title" style="color:#fff;">City of <span style="color:#cc88ff;text-shadow:0 0 30px rgba(200,100,255,0.5);">Legacy</span></div>
      <div class="h-line" style="background:linear-gradient(90deg,#cc88ff,var(--blue));box-shadow:0 0 8px #cc88ff;"></div>
      <p class="section-body">
        A city of cultural influence and musical legacy. From the Hacienda to Oasis, from Factory Records to contemporary arts — Manchester writes its own cultural chapter with unapologetic authenticity.
      </p>
      <div class="wave-bars" id="wave-bars">
      <div style="text-align:center;margin-top:8px;">
        <button class="explore-btn purple" onclick="openModal('culture', this)">
          Culture & Sound <span class="btn-arrow">→</span>
        </button>
      </div>
    </div>
  </div>
</section>

<!-- SECTION 7: FINALE -->
<section id="finale">
  <canvas class="section-canvas" id="finale-canvas"></canvas>
  <div class="gradient-overlay" style="background:radial-gradient(ellipse at 50% 100%,rgba(0,255,136,0.08),transparent 65%)"></div>
  <div class="gradient-overlay" style="background:linear-gradient(to bottom,var(--dark) 0%,transparent 20%,transparent 80%,var(--dark) 100%)"></div>
  <div class="section-content">
    <div class="glass-panel" id="panel-finale" style="border-color:rgba(0,255,136,0.15);">
      <div class="finale-title">Manchester<br>Continues<br>to Evolve</div>
      <div class="finale-sub">Where history meets innovation</div>
      <div class="h-line" style="background:linear-gradient(90deg,var(--green),var(--blue));margin-top:40px;"></div>
      <p class="section-body" style="margin-top:28px;font-size:0.9rem;letter-spacing:0.05em;">
        From cotton mills to graphene labs. From Peterloo to global media. The city that never stopped building itself.
      </p>
    </div>
  </div>
</section>

<!-- Three.js + GSAP -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

<script>
gsap.registerPlugin(ScrollTrigger);

// ===== CURSOR =====
const cur = document.getElementById('cursor');
const curR = document.getElementById('cursor-ring');
let mx=0,my=0,rx=0,ry=0;
document.addEventListener('mousemove',e=>{
  mx=e.clientX; my=e.clientY;
  cur.style.left=mx+'px'; cur.style.top=my+'px';
});
function animCursor(){
  rx+=(mx-rx)*0.12; ry+=(my-ry)*0.12;
  curR.style.left=rx+'px'; curR.style.top=ry+'px';
  requestAnimationFrame(animCursor);
}
animCursor();
document.querySelectorAll('a,.tag,.nav-items a').forEach(el=>{
  el.addEventListener('mouseenter',()=>{
    curR.style.width='58px'; curR.style.height='58px';
    curR.style.borderColor='rgba(0,180,255,0.7)';
  });
  el.addEventListener('mouseleave',()=>{
    curR.style.width='36px'; curR.style.height='36px';
    curR.style.borderColor='rgba(0,180,255,0.4)';
  });
});

// ===== PROGRESS BAR =====
const prog = document.getElementById('progress');
document.addEventListener('scroll',()=>{
  const p=(window.scrollY/(document.body.scrollHeight-window.innerHeight))*100;
  prog.style.width=p+'%';
});

// ===== PARTICLE BACKGROUND =====
(function(){
  const pc=document.getElementById('particle-canvas');
  const ctx=pc.getContext('2d');
  let W,H,particles=[];
  function resize(){ W=pc.width=window.innerWidth; H=pc.height=window.innerHeight; }
  resize(); window.addEventListener('resize',resize);
  class P{
    constructor(){this.reset();}
    reset(){
      this.x=Math.random()*W; this.y=Math.random()*H;
      this.vx=(Math.random()-0.5)*0.25; this.vy=-Math.random()*0.35-0.05;
      this.life=0; this.maxLife=200+Math.random()*300;
      this.r=Math.random()*1.2+0.3;
      this.hue=Math.random()>0.5?200:150;
    }
    update(){
      this.x+=this.vx; this.y+=this.vy; this.life++;
      if(this.life>this.maxLife||this.y<-10) this.reset();
    }
    draw(){
      const a=Math.sin((this.life/this.maxLife)*Math.PI)*0.5;
      ctx.beginPath(); ctx.arc(this.x,this.y,this.r,0,Math.PI*2);
      ctx.fillStyle=`hsla(${this.hue},100%,70%,${a})`;
      ctx.fill();
    }
  }
  for(let i=0;i<90;i++) particles.push(new P());
  function loop(){ ctx.clearRect(0,0,W,H); particles.forEach(p=>{p.update();p.draw();}); requestAnimationFrame(loop); }
  loop();
})();

// ===== WAVE BARS =====
const waveContainer=document.getElementById('wave-bars');
const barHeights=[14,28,45,60,50,35,55,40,25,48,60,38,22,52,43,30,55,60,44,28,36,52,60,38];
barHeights.forEach((h,i)=>{
  const b=document.createElement('div');
  b.className='bar';
  b.style.cssText=`--h:${h}px;animation-delay:${(i*0.07).toFixed(2)}s;height:${h}px;`;
  waveContainer.appendChild(b);
});

// ===== THREE.JS SCENES =====
function makeRenderer(canvas){
  const r=new THREE.WebGLRenderer({canvas,antialias:true,alpha:true});
  r.setPixelRatio(Math.min(window.devicePixelRatio,2));
  r.setSize(canvas.offsetWidth,canvas.offsetHeight);
  r.shadowMap.enabled=true;
  r.shadowMap.type=THREE.PCFSoftShadowMap;
  r.toneMapping=THREE.ACESFilmicToneMapping;
  r.toneMappingExposure=1.1;
  return r;
}

// ── HERO: Night skyline ──────────────────────────────────────────
(function(){
  const canvas=document.getElementById('hero-canvas');
  const scene=new THREE.Scene();
  scene.fog=new THREE.FogExp2(0x010509,0.012);
  const cam=new THREE.PerspectiveCamera(60,canvas.offsetWidth/canvas.offsetHeight,0.1,1000);
  cam.position.set(0,4,28);
  cam.lookAt(0,3,0);
  const ren=makeRenderer(canvas);

  // Lighting
  const ambient=new THREE.AmbientLight(0x0a1a2e,3);
  scene.add(ambient);
  const dir=new THREE.DirectionalLight(0x00b4ff,1.5);
  dir.position.set(-10,20,10); scene.add(dir);
  const hemi=new THREE.HemisphereLight(0x001030,0x000000,2);
  scene.add(hemi);

  // Ground reflection plane
  const gGeo=new THREE.PlaneGeometry(200,200);
  const gMat=new THREE.MeshStandardMaterial({color:0x010305,roughness:0.2,metalness:0.8});
  const ground=new THREE.Mesh(gGeo,gMat);
  ground.rotation.x=-Math.PI/2; ground.position.y=-2; scene.add(ground);

  // Skyline buildings
  const buildings=[];
  const buildingData=[
    {x:-18,z:-5,w:2.5,h:14,d:2.5},{x:-15,z:-2,w:2,h:9,d:2},
    {x:-12,z:-4,w:3,h:18,d:3},{x:-9,z:-2,w:2,h:11,d:2},
    {x:-6,z:-3,w:2.5,h:22,d:2.5},{x:-3,z:-2,w:2,h:8,d:2},
    {x:0,z:-5,w:3.5,h:28,d:3.5},{x:3,z:-2,w:2,h:12,d:2},
    {x:6,z:-3,w:3,h:20,d:3},{x:9,z:-2,w:2,h:10,d:2},
    {x:12,z:-4,w:2.5,h:16,d:2.5},{x:15,z:-2,w:2,h:7,d:2},
    {x:18,z:-5,w:3,h:13,d:3},
    {x:-20,z:-10,w:2,h:8,d:2},{x:-16,z:-9,w:2,h:12,d:2},
    {x:-8,z:-9,w:2.5,h:10,d:2.5},{x:0,z:-10,w:2,h:6,d:2},
    {x:8,z:-9,w:2.5,h:11,d:2.5},{x:16,z:-9,w:2,h:9,d:2},
    {x:20,z:-10,w:2,h:7,d:2},
  ];

  buildingData.forEach(b=>{
    const geo=new THREE.BoxGeometry(b.w,b.h,b.d);
    const mat=new THREE.MeshStandardMaterial({
      color:0x0d1a2e, roughness:0.4, metalness:0.7,
      emissive:new THREE.Color(0x001030), emissiveIntensity:0.3
    });
    const mesh=new THREE.Mesh(geo,mat);
    mesh.position.set(b.x, b.h/2-2+0.5, b.z);
    mesh.castShadow=true; mesh.receiveShadow=true;
    scene.add(mesh); buildings.push({mesh,h:b.h});

    // Windows
    const wRows=Math.floor(b.h/1.4); const wCols=Math.floor(b.w/1.1);
    for(let r=0;r<wRows;r++){
      for(let c=0;c<wCols;c++){
        if(Math.random()<0.55){
          const wGeo=new THREE.PlaneGeometry(0.28,0.35);
          const lit=Math.random()<0.7;
          const wcol=lit?(Math.random()<0.15?new THREE.Color(0x00b4ff):new THREE.Color(0xffffcc)):new THREE.Color(0x112233);
          const wMat=new THREE.MeshBasicMaterial({color:wcol,side:THREE.FrontSide});
          const win=new THREE.Mesh(wGeo,wMat);
          const fx=(-b.w/2+0.4+(c*(b.w/(wCols)))%b.w);
          const fy=(-b.h/2+0.5+r*1.4+0.4);
          win.position.set(mesh.position.x+fx, mesh.position.y+fy, mesh.position.z+b.d/2+0.01);
          scene.add(win);
          if(lit&&Math.random()<0.12){
            const pl=new THREE.PointLight(0x00b4ff,0.8,4);
            pl.position.set(win.position.x,win.position.y,win.position.z+0.5);
            scene.add(pl);
          }
        }
      }
    }
    // Antenna
    if(b.h>15){
      const aGeo=new THREE.CylinderGeometry(0.04,0.04,3);
      const aMat=new THREE.MeshBasicMaterial({color:0x333333});
      const ant=new THREE.Mesh(aGeo,aMat);
      ant.position.set(mesh.position.x,mesh.position.y+b.h/2+1.5,mesh.position.z);
      scene.add(ant);
      const light=new THREE.PointLight(0xff2200,2,3);
      light.position.copy(ant.position); light.position.y+=1.5;
      scene.add(light);
    }
  });

  // Stars
  const starGeo=new THREE.BufferGeometry();
  const starPos=[];
  for(let i=0;i<1200;i++){
    starPos.push((Math.random()-0.5)*300,(Math.random()*80+20),(Math.random()-0.5)*300);
  }
  starGeo.setAttribute('position',new THREE.Float32BufferAttribute(starPos,3));
  const starMat=new THREE.PointsMaterial({color:0xffffff,size:0.18,transparent:true,opacity:0.7});
  scene.add(new THREE.Points(starGeo,starMat));

  // Moon glow
  const moonGeo=new THREE.SphereGeometry(1.8,16,16);
  const moonMat=new THREE.MeshBasicMaterial({color:0xddeeff,transparent:true,opacity:0.85});
  const moon=new THREE.Mesh(moonGeo,moonMat);
  moon.position.set(15,30,-40); scene.add(moon);
  const moonLight=new THREE.PointLight(0x8899cc,1.5,200);
  moonLight.position.copy(moon.position); scene.add(moonLight);

  // Volumetric beams
  for(let i=0;i<6;i++){
    const bGeo=new THREE.CylinderGeometry(0.02,0.8,40,8,1,true);
    const bMat=new THREE.MeshBasicMaterial({color:0x00b4ff,transparent:true,opacity:0.03,side:THREE.DoubleSide});
    const beam=new THREE.Mesh(bGeo,bMat);
    beam.position.set((Math.random()-0.5)*30,18,(Math.random()-0.5)*10-5);
    scene.add(beam);
  }

  // Mouse
  let mouseX=0,mouseY=0;
  document.addEventListener('mousemove',e=>{mouseX=(e.clientX/window.innerWidth-0.5)*2; mouseY=(e.clientY/window.innerHeight-0.5)*2;});

  let scrollY=0;
  window.addEventListener('scroll',()=>{ scrollY=window.scrollY; });

  function resize(){
    cam.aspect=canvas.offsetWidth/canvas.offsetHeight;
    cam.updateProjectionMatrix();
    ren.setSize(canvas.offsetWidth,canvas.offsetHeight);
  }
  window.addEventListener('resize',resize);

  let t=0;
  function animate(){
    requestAnimationFrame(animate);
    t+=0.01;
    cam.position.x+=(mouseX*3-cam.position.x)*0.02;
    cam.position.y+=(-mouseY*2+4-cam.position.y)*0.02;
    cam.position.z=28-Math.min(scrollY*0.015,16);
    cam.lookAt(0,3+scrollY*0.004,0);

    // Window flicker
    if(Math.random()<0.005) {
      scene.children.forEach(c=>{
        if(c.isMesh&&c.geometry.type==='PlaneGeometry'&&Math.random()<0.01){
          c.material.opacity=Math.random()<0.5?1:0.1;
        }
      });
    }
    ren.render(scene,cam);
  }
  animate();

  // Trigger hero title
  setTimeout(()=>{
    document.getElementById('hero-title').classList.add('visible');
    document.getElementById('hero-sub').classList.add('visible');
  },400);
})();

// ── INDUSTRIAL: Factory silhouettes + smoke ─────────────────────
(function(){
  const canvas=document.getElementById('industrial-canvas');
  const scene=new THREE.Scene();
  scene.fog=new THREE.FogExp2(0x1a0800,0.018);
  const cam=new THREE.PerspectiveCamera(60,canvas.offsetWidth/canvas.offsetHeight,0.1,500);
  cam.position.set(0,6,22); cam.lookAt(0,4,0);
  const ren=makeRenderer(canvas);
  ren.setClearColor(0x100500,1);

  const hemi=new THREE.HemisphereLight(0xff6600,0x220000,1.5);
  scene.add(hemi);
  const amber=new THREE.DirectionalLight(0xff8800,2);
  amber.position.set(-5,15,5); scene.add(amber);

  // Factory silhouettes
  const factories=[
    {x:-16,w:5,h:9,d:4},{x:-9,w:4,h:7,d:3},{x:-2,w:6,h:12,d:5},
    {x:6,w:4,h:8,d:3},{x:13,w:5,h:10,d:4},{x:20,w:4,h:7,d:3},
  ];
  factories.forEach(f=>{
    const geo=new THREE.BoxGeometry(f.w,f.h,f.d);
    const mat=new THREE.MeshStandardMaterial({color:0x1a0800,roughness:1,metalness:0,emissive:0x200800,emissiveIntensity:0.3});
    const m=new THREE.Mesh(geo,mat);
    m.position.set(f.x,f.h/2-2,-(Math.random()*4+2));
    scene.add(m);
    // Chimney stacks
    for(let i=0;i<3;i++){
      const cGeo=new THREE.CylinderGeometry(0.2,0.3,5+Math.random()*3);
      const cMat=new THREE.MeshStandardMaterial({color:0x111111,roughness:1});
      const ch=new THREE.Mesh(cGeo,cMat);
      ch.position.set(m.position.x+(i-1)*1.5,m.position.y+f.h/2+3,m.position.z);
      scene.add(ch);
      const glow=new THREE.PointLight(0xff4400,1.5,8);
      glow.position.set(ch.position.x,ch.position.y+3,ch.position.z);
      scene.add(glow);
    }
  });

  // Smoke particles
  const smokeParts=[];
  const sGeo=new THREE.SphereGeometry(0.4,6,6);
  for(let i=0;i<60;i++){
    const sMat=new THREE.MeshBasicMaterial({color:0x443322,transparent:true,opacity:Math.random()*0.25+0.05});
    const s=new THREE.Mesh(sGeo,sMat);
    const fx=(Math.random()-0.5)*36;
    s.position.set(fx,10+Math.random()*15,(Math.random()-0.5)*10-5);
    s.scale.setScalar(1+Math.random()*3);
    scene.add(s);
    smokeParts.push({mesh:s,vy:0.04+Math.random()*0.04,vx:(Math.random()-0.5)*0.01,ox:s.position.x,oy:s.position.y});
  }

  // Ground
  const gGeo=new THREE.PlaneGeometry(200,200);
  const gMat=new THREE.MeshStandardMaterial({color:0x100800,roughness:1});
  const g=new THREE.Mesh(gGeo,gMat);
  g.rotation.x=-Math.PI/2; g.position.y=-2; scene.add(g);

  let t=0,mouseX=0,mouseY=0;
  document.addEventListener('mousemove',e=>{mouseX=(e.clientX/window.innerWidth-0.5)*2; mouseY=(e.clientY/window.innerHeight-0.5)*2;});

  function resize(){cam.aspect=canvas.offsetWidth/canvas.offsetHeight;cam.updateProjectionMatrix();ren.setSize(canvas.offsetWidth,canvas.offsetHeight);}
  window.addEventListener('resize',resize);

  function animate(){
    requestAnimationFrame(animate); t+=0.008;
    cam.position.x+=(mouseX*2-cam.position.x)*0.015;
    smokeParts.forEach(p=>{
      p.mesh.position.y+=p.vy;
      p.mesh.position.x+=p.vx+Math.sin(t+p.ox)*0.005;
      p.mesh.material.opacity-=0.0003;
      if(p.mesh.position.y>30||p.mesh.material.opacity<0.01){
        p.mesh.position.y=8+Math.random()*3;
        p.mesh.position.x=p.ox;
        p.mesh.material.opacity=Math.random()*0.2+0.05;
      }
    });
    ren.render(scene,cam);
  }
  animate();
})();

// ── ECONOMY: Modern neon skyline + network ──────────────────────
(function(){
  const canvas=document.getElementById('economy-canvas');
  const scene=new THREE.Scene();
  scene.fog=new THREE.FogExp2(0x020818,0.012);
  const cam=new THREE.PerspectiveCamera(60,canvas.offsetWidth/canvas.offsetHeight,0.1,500);
  cam.position.set(0,5,24); cam.lookAt(0,6,0);
  const ren=makeRenderer(canvas);
  ren.setClearColor(0x020818,1);

  const ambient=new THREE.AmbientLight(0x050a20,5);
  scene.add(ambient);
  const blue=new THREE.DirectionalLight(0x0044ff,3);
  blue.position.set(-10,20,10); scene.add(blue);

  // Skyscrapers
  const bldgs=[
    {x:-14,w:2.5,h:18,d:2.5,col:0x0d2040},
    {x:-10,w:2,h:12,d:2,col:0x0a1830},
    {x:-6,w:3,h:25,d:3,col:0x0d2040},
    {x:-2,w:2,h:16,d:2,col:0x0a1830},
    {x:2,w:3.5,h:30,d:3.5,col:0x0f2550},
    {x:6,w:2.5,h:20,d:2.5,col:0x0d2040},
    {x:10,w:2,h:14,d:2,col:0x0a1830},
    {x:14,w:3,h:22,d:3,col:0x0d2040},
  ];

  const buildingMeshes=[];
  bldgs.forEach(b=>{
    const geo=new THREE.BoxGeometry(b.w,b.h,b.d);
    const mat=new THREE.MeshStandardMaterial({color:b.col,roughness:0.2,metalness:0.9,emissive:new THREE.Color(0x001040),emissiveIntensity:0.5});
    const m=new THREE.Mesh(geo,mat);
    m.position.set(b.x,b.h/2-2+0.5,-3);
    scene.add(m); buildingMeshes.push(m);

    // Neon outline edges
    const edges=new THREE.EdgesGeometry(geo);
    const lineMat=new THREE.LineBasicMaterial({color:0x00b4ff,transparent:true,opacity:0.35});
    const lines=new THREE.LineSegments(edges,lineMat);
    lines.position.copy(m.position); scene.add(lines);

    // Windows
    const wRows=Math.floor(b.h/1.3); const wCols=Math.floor(b.w/0.9);
    for(let r=0;r<wRows;r++) for(let c=0;c<wCols;c++){
      if(Math.random()<0.6){
        const wGeo=new THREE.PlaneGeometry(0.25,0.3);
        const col=Math.random()<0.2?0x00b4ff:0xffffaa;
        const wMat=new THREE.MeshBasicMaterial({color:col,transparent:true,opacity:0.6+Math.random()*0.4});
        const win=new THREE.Mesh(wGeo,wMat);
        const wx=(c/(wCols-1||1)-0.5)*(b.w-0.5);
        const wy=-b.h/2+0.5+r*1.3+0.4;
        win.position.set(m.position.x+wx,m.position.y+wy,m.position.z+b.d/2+0.01);
        scene.add(win);
      }
    }
  });

  // Network lines between buildings
  buildingMeshes.forEach((a,i)=>{
    buildingMeshes.forEach((b,j)=>{
      if(j<=i||Math.abs(i-j)>3) return;
      const pts=[new THREE.Vector3(a.position.x,a.position.y,a.position.z+1),
                 new THREE.Vector3(b.position.x,b.position.y,b.position.z+1)];
      const geo=new THREE.BufferGeometry().setFromPoints(pts);
      const mat=new THREE.LineBasicMaterial({color:0x00ff88,transparent:true,opacity:0.12});
      scene.add(new THREE.Line(geo,mat));
    });
  });

  // Stars
  const sGeo=new THREE.BufferGeometry();
  const sp=[];
  for(let i=0;i<600;i++) sp.push((Math.random()-0.5)*200,Math.random()*60+15,(Math.random()-0.5)*100-20);
  sGeo.setAttribute('position',new THREE.Float32BufferAttribute(sp,3));
  scene.add(new THREE.Points(sGeo,new THREE.PointsMaterial({color:0xffffff,size:0.12,transparent:true,opacity:0.6})));

  let mouseX=0,mouseY=0,t=0;
  document.addEventListener('mousemove',e=>{mouseX=(e.clientX/window.innerWidth-0.5)*2; mouseY=(e.clientY/window.innerHeight-0.5)*2;});
  function resize(){cam.aspect=canvas.offsetWidth/canvas.offsetHeight;cam.updateProjectionMatrix();ren.setSize(canvas.offsetWidth,canvas.offsetHeight);}
  window.addEventListener('resize',resize);

  function animate(){
    requestAnimationFrame(animate); t+=0.006;
    cam.position.x+=(mouseX*3-cam.position.x)*0.015;
    cam.position.y+=(-mouseY*1.5+5-cam.position.y)*0.015;
    // Pulse emissive
    buildingMeshes.forEach((m,i)=>{
      m.material.emissiveIntensity=0.4+Math.sin(t+i*0.7)*0.15;
    });
    ren.render(scene,cam);
  }
  animate();
})();

// ── EDUCATION: Particle energy pulse ────────────────────────────
(function(){
  const canvas=document.getElementById('education-canvas');
  const scene=new THREE.Scene();
  scene.fog=new THREE.FogExp2(0x010a10,0.014);
  const cam=new THREE.PerspectiveCamera(60,canvas.offsetWidth/canvas.offsetHeight,0.1,500);
  cam.position.set(0,4,20); cam.lookAt(0,3,0);
  const ren=makeRenderer(canvas);
  ren.setClearColor(0x010a10,1);

  const ambient=new THREE.AmbientLight(0x003322,6);
  scene.add(ambient);
  const gl=new THREE.PointLight(0x00ff88,4,50);
  gl.position.set(0,10,5); scene.add(gl);

  // Hexagonal grid floor
  function hexPos(q,r){return{x:(q+r*0.5)*2.2, z:r*1.9};}
  for(let q=-8;q<=8;q++) for(let r=-4;r<=4;r++){
    const p=hexPos(q,r);
    const geo=new THREE.CylinderGeometry(0.9,0.9,0.05,6);
    const h=Math.random()*0.8;
    const mat=new THREE.MeshStandardMaterial({
      color:new THREE.Color(0,h*0.4,h*0.2),
      emissive:new THREE.Color(0,h*0.3,h*0.15),
      emissiveIntensity:0.8,roughness:0.3,metalness:0.8
    });
    const m=new THREE.Mesh(geo,mat);
    m.position.set(p.x,-2+Math.random()*0.3,p.z-8);
    scene.add(m);
  }

  // Energy sphere
  const sphereGeo=new THREE.SphereGeometry(2,32,32);
  const sphereMat=new THREE.MeshStandardMaterial({
    color:0x00ff88,emissive:0x00aa44,emissiveIntensity:0.8,
    roughness:0.1,metalness:0.5,wireframe:true,transparent:true,opacity:0.3
  });
  const sphere=new THREE.Mesh(sphereGeo,sphereMat);
  sphere.position.set(0,4,-5); scene.add(sphere);
  const innerSphere=new THREE.Mesh(new THREE.SphereGeometry(1.4,16,16),
    new THREE.MeshBasicMaterial({color:0x00ff88,transparent:true,opacity:0.08}));
  innerSphere.position.copy(sphere.position); scene.add(innerSphere);
  const sphereLight=new THREE.PointLight(0x00ff88,4,25);
  sphereLight.position.copy(sphere.position); scene.add(sphereLight);

  // Orbiting particles
  const orbits=[];
  for(let i=0;i<60;i++){
    const geo=new THREE.SphereGeometry(0.06,4,4);
    const mat=new THREE.MeshBasicMaterial({color:Math.random()<0.5?0x00ff88:0x00b4ff,transparent:true,opacity:0.8});
    const m=new THREE.Mesh(geo,mat);
    scene.add(m);
    orbits.push({mesh:m,r:2.5+Math.random()*3,angle:Math.random()*Math.PI*2,speed:0.003+Math.random()*0.008,elev:Math.random()*Math.PI-Math.PI/2});
  }

  let mouseX=0,mouseY=0,t=0;
  document.addEventListener('mousemove',e=>{mouseX=(e.clientX/window.innerWidth-0.5)*2;mouseY=(e.clientY/window.innerHeight-0.5)*2;});
  function resize(){cam.aspect=canvas.offsetWidth/canvas.offsetHeight;cam.updateProjectionMatrix();ren.setSize(canvas.offsetWidth,canvas.offsetHeight);}
  window.addEventListener('resize',resize);

  function animate(){
    requestAnimationFrame(animate); t+=0.01;
    cam.position.x+=(mouseX*2-cam.position.x)*0.015;
    sphere.rotation.y=t*0.4; sphere.rotation.x=t*0.2;
    innerSphere.rotation.y=-t*0.3;
    sphereLight.intensity=3+Math.sin(t*2)*1.5;
    orbits.forEach(o=>{
      o.angle+=o.speed;
      o.mesh.position.set(
        sphere.position.x+Math.cos(o.angle)*o.r*Math.cos(o.elev),
        sphere.position.y+Math.sin(o.elev)*o.r,
        sphere.position.z+Math.sin(o.angle)*o.r*Math.cos(o.elev)
      );
    });
    ren.render(scene,cam);
  }
  animate();
})();

// ── FOOTBALL: 3D Stadium ─────────────────────────────────────────
(function(){
  const canvas=document.getElementById('football-canvas');
  const scene=new THREE.Scene();
  scene.fog=new THREE.Fog(0x010a03,30,100);
  const cam=new THREE.PerspectiveCamera(50,canvas.offsetWidth/canvas.offsetHeight,0.1,500);
  cam.position.set(0,30,50); cam.lookAt(0,0,0);
  const ren=makeRenderer(canvas);
  ren.setClearColor(0x010a03,1);

  const ambient=new THREE.AmbientLight(0x050f05,4);
  scene.add(ambient);

  // Pitch
  const pitchGeo=new THREE.PlaneGeometry(68,105);
  const pitchMat=new THREE.MeshStandardMaterial({color:0x1a6b1a,roughness:0.9,metalness:0,emissive:0x0a3a0a,emissiveIntensity:0.2});
  const pitch=new THREE.Mesh(pitchGeo,pitchMat);
  pitch.rotation.x=-Math.PI/2; pitch.position.y=-0.1; scene.add(pitch);

  // Pitch lines
  function line(x1,z1,x2,z2){
    const pts=[new THREE.Vector3(x1,0.02,z1),new THREE.Vector3(x2,0.02,z2)];
    const g=new THREE.BufferGeometry().setFromPoints(pts);
    const m=new THREE.LineBasicMaterial({color:0xffffff,transparent:true,opacity:0.4});
    scene.add(new THREE.Line(g,m));
  }
  line(-34,0,34,0); line(-34,-52.5,-34,52.5); line(34,-52.5,34,52.5);
  line(-34,-52.5,34,-52.5); line(-34,52.5,34,52.5);
  line(-20.16,-52.5,-20.16,52.5); line(20.16,-52.5,20.16,52.5);

  // Center circle
  const ccGeo=new THREE.RingGeometry(9.15,9.45,48);
  const ccMat=new THREE.MeshBasicMaterial({color:0xffffff,transparent:true,opacity:0.35,side:THREE.DoubleSide});
  const cc=new THREE.Mesh(ccGeo,ccMat); cc.rotation.x=-Math.PI/2; scene.add(cc);

  // Stadium stands
  function stand(x,z,rx,ry,w,d){
    const geo=new THREE.BoxGeometry(w,12,d);
    const mat=new THREE.MeshStandardMaterial({color:0x1a1a2e,roughness:0.6,metalness:0.5,emissive:0x0a0a1a,emissiveIntensity:0.4});
    const m=new THREE.Mesh(geo,mat);
    m.position.set(x,4,z); m.rotation.y=ry;
    scene.add(m);
    // Lights on stands
    const pl=new THREE.PointLight(0xffffee,2,30);
    pl.position.set(x,14,z); scene.add(pl);
    // Crowd dots
    for(let i=0;i<180;i++){
      const dg=new THREE.SphereGeometry(0.15,4,4);
      const cols=[0xff0000,0xffffff,0x0000ff,0xffff00,0xff8800];
      const dm=new THREE.MeshBasicMaterial({color:cols[Math.floor(Math.random()*cols.length)],transparent:true,opacity:0.7});
      const crowd=new THREE.Mesh(dg,dm);
      crowd.position.set(
        x+(Math.random()-0.5)*(w*0.9),
        -1+Math.random()*6,
        z+(Math.random()-0.5)*(d*0.9)
      );
      scene.add(crowd);
    }
  }
  stand(0,-62,0,0,70,8);
  stand(0,62,0,Math.PI,70,8);
  stand(-42,0,0,Math.PI/2,110,8);
  stand(42,0,0,-Math.PI/2,110,8);

  // Floodlights
  [[34,52.5],[-34,52.5],[34,-52.5],[-34,-52.5]].forEach(([x,z])=>{
    const pGeo=new THREE.CylinderGeometry(0.2,0.3,25);
    const pMat=new THREE.MeshStandardMaterial({color:0x333333});
    const pole=new THREE.Mesh(pGeo,pMat);
    pole.position.set(x,11,z); scene.add(pole);
    const sLight=new THREE.SpotLight(0xffffee,50,120,0.5,0.3);
    sLight.position.set(x,24,z); sLight.target.position.set(0,0,0);
    scene.add(sLight); scene.add(sLight.target);
    // Lens flare circle
    const flare=new THREE.Mesh(new THREE.CircleGeometry(1,16),new THREE.MeshBasicMaterial({color:0xffffee,transparent:true,opacity:0.8,side:THREE.DoubleSide}));
    flare.position.set(x,24,z); flare.lookAt(0,0,0); scene.add(flare);
  });

  // Stars
  const sg=new THREE.BufferGeometry();
  const sp=[];
  for(let i=0;i<800;i++) sp.push((Math.random()-0.5)*300,Math.random()*80+30,(Math.random()-0.5)*300);
  sg.setAttribute('position',new THREE.Float32BufferAttribute(sp,3));
  scene.add(new THREE.Points(sg,new THREE.PointsMaterial({color:0xffffff,size:0.2,transparent:true,opacity:0.6})));

  let t=0,mouseX=0,mouseY=0;
  document.addEventListener('mousemove',e=>{mouseX=(e.clientX/window.innerWidth-0.5)*2;mouseY=(e.clientY/window.innerHeight-0.5)*2;});
  function resize(){cam.aspect=canvas.offsetWidth/canvas.offsetHeight;cam.updateProjectionMatrix();ren.setSize(canvas.offsetWidth,canvas.offsetHeight);}
  window.addEventListener('resize',resize);

  function animate(){
    requestAnimationFrame(animate); t+=0.005;
    cam.position.x=Math.sin(t*0.3)*10+mouseX*5;
    cam.position.y=30+Math.sin(t*0.2)*5-mouseY*5;
    cam.position.z=50+Math.cos(t*0.2)*5;
    cam.lookAt(0,0,0);
    ren.render(scene,cam);
  }
  animate();
})();

// ── CULTURE: Neon nightlife ──────────────────────────────────────
(function(){
  const canvas=document.getElementById('culture-canvas');
  const scene=new THREE.Scene();
  scene.fog=new THREE.FogExp2(0x060010,0.018);
  const cam=new THREE.PerspectiveCamera(60,canvas.offsetWidth/canvas.offsetHeight,0.1,300);
  cam.position.set(0,5,22); cam.lookAt(0,5,0);
  const ren=makeRenderer(canvas);
  ren.setClearColor(0x060010,1);

  const ambient=new THREE.AmbientLight(0x110033,5);
  scene.add(ambient);

  // Neon city
  const neonCols=[0xff00ff,0x00ffff,0xff6600,0xcc00ff,0x00ff88];
  for(let i=0;i<16;i++){
    const x=(i-8)*3.5;
    const h=6+Math.random()*14;
    const geo=new THREE.BoxGeometry(2+Math.random()*1.5,h,2+Math.random()*1.5);
    const col=neonCols[i%neonCols.length];
    const mat=new THREE.MeshStandardMaterial({
      color:0x0a0010, roughness:0.2, metalness:0.9,
      emissive:new THREE.Color(col).multiplyScalar(0.06)
    });
    const m=new THREE.Mesh(geo,mat);
    m.position.set(x,h/2-2,-(Math.random()*8+2));
    scene.add(m);

    // Neon edge
    const edge=new THREE.EdgesGeometry(geo);
    const lineMat=new THREE.LineBasicMaterial({color:col,transparent:true,opacity:0.45});
    const lines=new THREE.LineSegments(edge,lineMat);
    lines.position.copy(m.position); scene.add(lines);

    // Neon sign glow
    const pl=new THREE.PointLight(col,1.5,12);
    pl.position.set(x,h-1,m.position.z+1); scene.add(pl);
  }

  // Reflective ground
  const gGeo=new THREE.PlaneGeometry(200,200);
  const gMat=new THREE.MeshStandardMaterial({color:0x050010,roughness:0.05,metalness:1});
  const g=new THREE.Mesh(gGeo,gMat);
  g.rotation.x=-Math.PI/2; g.position.y=-2; scene.add(g);

  // Stars
  const sg=new THREE.BufferGeometry();
  const sp=[];
  for(let i=0;i<600;i++) sp.push((Math.random()-0.5)*200,Math.random()*50+15,(Math.random()-0.5)*100);
  sg.setAttribute('position',new THREE.Float32BufferAttribute(sp,3));
  scene.add(new THREE.Points(sg,new THREE.PointsMaterial({color:0xffffff,size:0.12,transparent:true,opacity:0.5})));

  let t=0,mouseX=0,mouseY=0;
  document.addEventListener('mousemove',e=>{mouseX=(e.clientX/window.innerWidth-0.5)*2;mouseY=(e.clientY/window.innerHeight-0.5)*2;});
  function resize(){cam.aspect=canvas.offsetWidth/canvas.offsetHeight;cam.updateProjectionMatrix();ren.setSize(canvas.offsetWidth,canvas.offsetHeight);}
  window.addEventListener('resize',resize);

  // Animated neon pulse
  let neonLights=scene.children.filter(c=>c.isPointLight);

  function animate(){
    requestAnimationFrame(animate); t+=0.012;
    cam.position.x+=(mouseX*3-cam.position.x)*0.015;
    neonLights.forEach((l,i)=>{l.intensity=1.2+Math.sin(t*2+i)*0.8;});
    ren.render(scene,cam);
  }
  animate();
})();

// ── FINALE: City from above ──────────────────────────────────────
(function(){
  const canvas=document.getElementById('finale-canvas');
  const scene=new THREE.Scene();
  scene.fog=new THREE.FogExp2(0x010a08,0.008);
  const cam=new THREE.PerspectiveCamera(55,canvas.offsetWidth/canvas.offsetHeight,0.1,600);
  cam.position.set(0,50,40); cam.lookAt(0,0,0);
  const ren=makeRenderer(canvas);
  ren.setClearColor(0x010a08,1);

  const ambient=new THREE.AmbientLight(0x001a10,5);
  scene.add(ambient);
  const dir=new THREE.DirectionalLight(0x00ff88,1.5);
  dir.position.set(0,30,10); scene.add(dir);

  // City grid from above
  for(let x=-12;x<=12;x+=3){
    for(let z=-12;z<=12;z+=3){
      const h=3+Math.random()*16;
      const geo=new THREE.BoxGeometry(1.8,h,1.8);
      const mat=new THREE.MeshStandardMaterial({
        color:new THREE.Color(0,0.05+h*0.003,0.02+h*0.002),
        emissive:new THREE.Color(0,h*0.02,h*0.01),
        emissiveIntensity:0.8, roughness:0.3, metalness:0.8
      });
      const m=new THREE.Mesh(geo,mat);
      m.position.set(x,h/2-2,z); scene.add(m);
    }
  }

  // Network overlay lines
  for(let i=0;i<30;i++){
    const x1=(Math.random()-0.5)*30, z1=(Math.random()-0.5)*30;
    const x2=(Math.random()-0.5)*30, z2=(Math.random()-0.5)*30;
    const pts=[new THREE.Vector3(x1,8,z1),new THREE.Vector3(x2,8,z2)];
    const geo=new THREE.BufferGeometry().setFromPoints(pts);
    const mat=new THREE.LineBasicMaterial({color:0x00ff88,transparent:true,opacity:0.15});
    scene.add(new THREE.Line(geo,mat));
  }

  // Glow core
  const coreLight=new THREE.PointLight(0x00ff88,6,60);
  coreLight.position.set(0,10,0); scene.add(coreLight);
  const blueLight=new THREE.PointLight(0x00b4ff,4,80);
  blueLight.position.set(-20,8,20); scene.add(blueLight);

  // Stars
  const sg=new THREE.BufferGeometry();
  const sp=[];
  for(let i=0;i<1000;i++) sp.push((Math.random()-0.5)*400,Math.random()*100+60,(Math.random()-0.5)*400);
  sg.setAttribute('position',new THREE.Float32BufferAttribute(sp,3));
  scene.add(new THREE.Points(sg,new THREE.PointsMaterial({color:0xffffff,size:0.2,transparent:true,opacity:0.6})));

  let t=0,mouseX=0,mouseY=0;
  document.addEventListener('mousemove',e=>{mouseX=(e.clientX/window.innerWidth-0.5)*2;mouseY=(e.clientY/window.innerHeight-0.5)*2;});
  function resize(){cam.aspect=canvas.offsetWidth/canvas.offsetHeight;cam.updateProjectionMatrix();ren.setSize(canvas.offsetWidth,canvas.offsetHeight);}
  window.addEventListener('resize',resize);

  function animate(){
    requestAnimationFrame(animate); t+=0.005;
    cam.position.x=Math.sin(t*0.2)*8+mouseX*4;
    cam.position.z=40+Math.cos(t*0.15)*5;
    cam.lookAt(0,0,0);
    coreLight.intensity=5+Math.sin(t*1.5)*2;
    ren.render(scene,cam);
  }
  animate();
})();

// ===== INTERSECTION OBSERVER FOR PANELS =====
const panels=document.querySelectorAll('.glass-panel');
const observer=new IntersectionObserver((entries)=>{
  entries.forEach(e=>{
    if(e.isIntersecting) e.target.classList.add('visible');
  });
},{threshold:0.2});
panels.forEach(p=>observer.observe(p));

// ===== HANDLE CANVAS RESIZE =====
function handleAllResize(){
  document.querySelectorAll('.section-canvas').forEach(c=>{
    const sect=c.closest('section');
    // canvases get handled within their own IIFE
  });
}
window.addEventListener('resize',handleAllResize);



// ═══════════════════════════════════════════════════════════════
// MODAL DATA — rich content per section
// ═══════════════════════════════════════════════════════════════
const MODALS = {
  hero: {
    eyebrow: 'Manchester · England · 53.4808°N',
    title: 'The City That <span class="accent">Built</span> the World',
    emoji: '🏙️',
    theme: 'hero',
    accentColor: '#00b4ff',
    accentColor2: '#cc88ff',
    scene3d: 'city',
    intro: `Manchester isn't just a city — it's a force of nature. From its founding as a Roman fort in 79 AD to becoming the engine of the Industrial Revolution, Manchester has perpetually reinvented itself, forging a spirit that resonates globally: relentless, authentic, pioneering.`,
    rainbow: '✨ Manchester — Where History Lives',
    quote: { text: `"What Manchester does today, the rest of the world does tomorrow."`, author: '— Benjamin Disraeli, 1867' },
    cards: [
      { emoji: '🏛️', value: '79 AD', label: 'Founded by Romans', desc: 'Originally a Roman fortification called Mamucium on the River Medlock' },
      { emoji: '🌍', value: '553K', label: 'City Population', desc: 'Greater Manchester home to 2.9 million — fastest-growing UK metro' },
      { emoji: '🚂', value: '1830', label: 'First Railway', desc: 'Manchester–Liverpool: the world\'s first intercity passenger railway' },
      { emoji: '🌧️', value: '32"', label: 'Annual Rainfall', desc: 'Yes, it really does rain — but Mancunians wouldn\'t have it any other way' },
      { emoji: '🎓', value: '100K+', label: 'Students', desc: 'One of Europe\'s largest student populations — 5 universities in the city' },
      { emoji: '✈️', value: '3rd', label: 'UK Airport', desc: 'Manchester Airport connects to 200+ destinations worldwide' }
    ],
    timeline: [
      { year: '79 AD', text: 'Romans build fort Mamucium — the seed of Manchester.' },
      { year: '1301', text: 'Royal charter granted. Manchester becomes a market town.' },
      { year: '1761', text: 'Bridgewater Canal opens — kickstarts the Industrial Revolution.' },
      { year: '1830', text: 'World\'s first intercity railway links Manchester to Liverpool.' },
      { year: '1962', text: 'The Haçienda opens. Manchester music becomes global culture.' },
      { year: '2004', text: 'Graphene isolated at University of Manchester. Nobel Prize follows.' }
    ],
    tags: [
      { text: '🏴󠁧󠁢󠁥󠁮󠁧󠁿 Northern England', col: '#00b4ff' },
      { text: '⚡ Northern Powerhouse', col: '#00ff88' },
      { text: '🎵 Music Capital', col: '#cc88ff' },
      { text: '⚽ Football City', col: '#ff8800' },
      { text: '🔬 Science Hub', col: '#00b4ff' }
    ],
    progress: [
      { name: 'Economic Growth Rate', pct: 88, val: '7% p.a.' },
      { name: 'Global City Index', pct: 75, val: 'Alpha—' },
      { name: 'Innovation Score', pct: 82, val: '82/100' },
      { name: 'Cultural Influence', pct: 93, val: 'Top 10 UK' }
    ]
  },

  industrial: {
    eyebrow: '1760 — 1850 · The First Industrial City',
    title: 'Cotton, <span class="accent">Steam</span> & Fire',
    emoji: '🏭',
    theme: 'industrial',
    accentColor: '#ff8800',
    accentColor2: '#ffb347',
    scene3d: 'factory',
    intro: `The world had never seen anything like it. In the span of a single lifetime, Manchester transformed from a market town into the thundering heart of global manufacturing — a city of cotton, coal and human ambition that forged the modern world and sparked revolutions from Paris to Philadelphia.`,
    rainbow: '🔥 The Furnace of the Modern World',
    quote: { text: `"Manchester is the chimney of the world. Rich rascals, poor rogues, drunken ragamuffins and prostitutes form the moral and physical appearance of the streets."`, author: '— Friedrich Engels, 1845' },
    cards: [
      { emoji: '🏭', value: '50+', label: 'Cotton Mills by 1800', desc: 'Manchester\'s mills processed cotton from across the British Empire' },
      { emoji: '💧', value: '1761', label: 'Bridgewater Canal', desc: 'Halved coal prices overnight — the spark that lit the Industrial Revolution' },
      { emoji: '🔧', value: '1784', label: 'Steam Power', desc: 'Watt\'s steam engine adopted in Manchester mills — productivity explodes' },
      { emoji: '👥', value: '10x', label: 'Population 1771–1831', desc: 'From 25,000 to 250,000 in 60 years — the fastest urban growth in history' },
      { emoji: '📜', value: '1819', label: 'Peterloo Massacre', desc: 'Workers demand reform — 18 killed, sparking the path to democracy' },
      { emoji: '🧵', value: '80%', label: 'World Cotton Trade', desc: 'At its peak, Manchester controlled the majority of global cotton exchange' }
    ],
    timeline: [
      { year: '1761', text: 'Bridgewater Canal opens — the world\'s first major industrial canal.' },
      { year: '1781', text: 'First steam-powered cotton mills open in Manchester.' },
      { year: '1794', text: 'Manchester Exchange established — global cotton trading begins.' },
      { year: '1819', text: 'Peterloo Massacre — 80,000 march for political reform.' },
      { year: '1830', text: 'Liverpool & Manchester Railway — world\'s first intercity rail.' },
      { year: '1850', text: 'Manchester\'s population surpasses 300,000. Cottonopolis at peak.' }
    ],
    tags: [
      { text: '🧵 Cottonopolis', col: '#ff8800' },
      { text: '💨 Steam Power', col: '#ffb347' },
      { text: '⛏️ Industrial Revolution', col: '#ff8800' },
      { text: '🚢 Canal Network', col: '#ff6600' },
      { text: '📰 Workers Rights', col: '#ffb347' }
    ],
    progress: [
      { name: 'Global Cotton Market Share', pct: 80, val: '~80%' },
      { name: 'UK Industrial Output', pct: 70, val: 'Top 3' },
      { name: 'Canal Network (miles)', pct: 65, val: '165mi' },
      { name: 'Mill Workers by 1850', pct: 90, val: '100K+' }
    ]
  },

  economy: {
    eyebrow: '21st Century · Northern Powerhouse',
    title: 'The Digital <span class="accent">North</span>',
    emoji: '💰',
    theme: 'economy',
    accentColor: '#00b4ff',
    accentColor2: '#00ff88',
    scene3d: 'network',
    intro: `Manchester's economy has undergone a breathtaking reinvention. Once defined by cotton and coal, the city now powers the digital age — home to KPMG's largest UK office outside London, MediaCityUK, a booming fintech scene, and some of Britain's fastest-growing tech startups.`,
    rainbow: '📈 £80 Billion Economy & Climbing',
    quote: { text: `"Greater Manchester is the most dynamic and commercially active region outside of London."`, author: '— UK Government Northern Powerhouse Report, 2022' },
    cards: [
      { emoji: '💷', value: '£80B', label: 'Regional Economy', desc: 'Greater Manchester GVA — second only to London among UK metro areas' },
      { emoji: '📺', value: '2011', label: 'MediaCityUK Opens', desc: 'BBC, ITV, dock10 studios — 250 media & tech firms call Salford home' },
      { emoji: '🏦', value: '2nd', label: 'Financial Hub', desc: 'Manchester is the UK\'s second-largest centre for financial & professional services' },
      { emoji: '🚀', value: '400+', label: 'Tech Startups', desc: 'Manchester Tech ecosystem growing at 20%+ per year — one of Europe\'s hottest' },
      { emoji: '🌐', value: '250K+', label: 'Digital Jobs', desc: 'Greater Manchester employs more digital workers than any UK region outside London' },
      { emoji: '📊', value: '7%', label: 'Annual Growth Rate', desc: 'Consistently outpacing national GDP growth for the past decade' }
    ],
    timeline: [
      { year: '1996', text: 'IRA bomb blast — Manchester\'s controversial catalyst for city regeneration.' },
      { year: '2002', text: 'Commonwealth Games. Manchester showcases itself to the world.' },
      { year: '2011', text: 'MediaCityUK opens in Salford Quays — media capital of the North.' },
      { year: '2015', text: 'Northern Powerhouse initiative announced. Devolution begins.' },
      { year: '2018', text: 'HSBC, Amazon, Booking.com open major Manchester HQs.' },
      { year: '2024', text: 'Manchester ranked top 5 global tech ecosystems to watch.' }
    ],
    tags: [
      { text: '📡 Tech & Digital', col: '#00b4ff' },
      { text: '🏦 Finance', col: '#00ff88' },
      { text: '🎬 MediaCityUK', col: '#00b4ff' },
      { text: '💊 Life Sciences', col: '#00ff88' },
      { text: '🌐 Fintech', col: '#4d96ff' }
    ],
    progress: [
      { name: 'GDP vs National Average', pct: 78, val: '+18%' },
      { name: 'Tech Sector Growth', pct: 84, val: '+22%' },
      { name: 'Foreign Investment (UK rank)', pct: 72, val: '2nd' },
      { name: 'Employment Rate', pct: 74, val: '74.2%' }
    ]
  },

  education: {
    eyebrow: 'Research & Discovery · Nobel Laureates',
    title: 'Where Atoms <span class="accent">Split</span>',
    emoji: '⚛️',
    theme: 'education',
    accentColor: '#00ff88',
    accentColor2: '#00b4ff',
    scene3d: 'atoms',
    intro: `The University of Manchester sits atop a legacy so extraordinary it defies belief — 25 Nobel Laureates, the discovery of graphene, the splitting of the atom, and Alan Turing's foundational work in computer science. Manchester doesn't just study the future. It creates it.`,
    rainbow: '🔬 Science That Changed Everything',
    quote: { text: `"The University of Manchester is where the modern world was invented."`, author: '— The Guardian, Science Special, 2021' },
    cards: [
      { emoji: '🏆', value: '25', label: 'Nobel Laureates', desc: 'More Nobel Prize winners than most nations — in Physics, Chemistry, Economics' },
      { emoji: '⚛️', value: '1917', text: '1917', label: 'Atom Split Here', desc: 'Ernest Rutherford split the atom at Manchester — changing physics forever' },
      { emoji: '💻', value: '1948', label: 'Baby Computer', desc: 'Manchester\'s Baby (SSEM) — the world\'s first stored-program computer runs here' },
      { emoji: '🔷', value: '2004', label: 'Graphene', desc: 'Andre Geim & Kostya Novoselov discover graphene — Nobel Prize 2010' },
      { emoji: '📐', value: '£1B', label: 'National Graphene Institute', desc: 'World\'s first graphene research institute, opened 2015 in Manchester' },
      { emoji: '🤖', value: 'Alan', label: 'Turing Was Here', desc: 'Father of computer science worked at Manchester from 1948 until his death' }
    ],
    timeline: [
      { year: '1824', text: 'University of Manchester founded — ranked globally top 30.' },
      { year: '1903', text: 'Ernest Rutherford moves to Manchester. Nuclear physics is born.' },
      { year: '1917', text: 'Rutherford splits the atom at the Victoria University of Manchester.' },
      { year: '1948', text: 'The Manchester Baby — world\'s first electronic stored-program computer.' },
      { year: '1952', text: 'Alan Turing publishes work on morphogenesis from Manchester.' },
      { year: '2004', text: 'Graphene isolated. The 21st century\'s wonder material discovered here.' }
    ],
    tags: [
      { text: '🔬 Graphene', col: '#00ff88' },
      { text: '⚛️ Nuclear Physics', col: '#00b4ff' },
      { text: '💻 Computing', col: '#00ff88' },
      { text: '🧬 Life Sciences', col: '#4dff88' },
      { text: '🧠 AI Research', col: '#00b4ff' }
    ],
    progress: [
      { name: 'World University Ranking', pct: 85, val: 'Top 30' },
      { name: 'Research Excellence', pct: 92, val: '92%' },
      { name: 'Graduate Employment', pct: 88, val: '88%' },
      { name: 'International Students', pct: 38, val: '38%' }
    ]
  },

  football: {
    eyebrow: 'The Beautiful Game · Global Capital',
    title: 'Theatre of <span class="accent">Dreams</span>',
    emoji: '⚽',
    theme: 'football',
    accentColor: '#e8edf5',
    accentColor2: '#00ff88',
    scene3d: 'stadium',
    intro: `Two clubs. One city. Infinite passion. Manchester United and Manchester City are two of the most storied, most-watched, most valuable football clubs on planet Earth — and they share a postcode. The Manchester Derby is the most-watched club match in the world, broadcast to 650 million people.`,
    rainbow: '🏆 Glory, Glory Manchester!',
    quote: { text: `"Football is not a matter of life and death — it's far more important than that."`, author: '— Bill Shankly (speaking about football as Mancunians feel it)' },
    cards: [
      { emoji: '🔴', value: '20', label: 'Man Utd League Titles', desc: 'Most league titles of any English club — dominance stretching back to 1908' },
      { emoji: '🔵', value: '10', label: 'Man City PL Titles', desc: '10 Premier League titles in 16 seasons — the most dominant era in English football' },
      { emoji: '🏟️', value: '74,310', label: 'Old Trafford Capacity', desc: 'The Theatre of Dreams — third-largest stadium in the UK' },
      { emoji: '💰', value: '£5.3B', label: 'Combined Club Value', desc: 'Two of the most valuable football clubs on Earth in the same city' },
      { emoji: '📺', value: '650M', label: 'Derby TV Audience', desc: 'The Manchester Derby is the most-watched club fixture in global football' },
      { emoji: '🌍', value: '1.5B', label: 'Combined Fanbase', desc: 'Red and Blue united in fandom across every continent on Earth' }
    ],
    timeline: [
      { year: '1878', text: 'Newton Heath LYR FC founded — becomes Manchester United in 1902.' },
      { year: '1880', text: 'Ardwick AFC founded — becomes Manchester City in 1894.' },
      { year: '1968', text: 'Manchester United win European Cup — first English club to do so.' },
      { year: '1999', text: 'United\'s Treble — PL, FA Cup, Champions League in one season.' },
      { year: '2012', text: 'City win PL on 93:20 — the most dramatic title moment ever.' },
      { year: '2023', text: 'City win the Treble — equalling United\'s legendary 1999 feat.' }
    ],
    tags: [
      { text: '🔴 Manchester United', col: '#ff2200' },
      { text: '🔵 Manchester City', col: '#6cbeff' },
      { text: '🏆 Champions League', col: '#e8c54a' },
      { text: '⚽ Premier League', col: '#00ff88' },
      { text: '🌍 Global Fanbase', col: '#ffffff' }
    ],
    progress: [
      { name: 'Combined Trophy Count', pct: 95, val: '100+' },
      { name: 'Global TV Viewership (rank)', pct: 99, val: '#1 Match' },
      { name: 'Stadium Utilization', pct: 98, val: '98%' },
      { name: 'Youth Academy Output', pct: 87, val: 'World-Class' }
    ]
  },

  culture: {
    eyebrow: 'Sound · Art · Identity',
    title: 'Loud, Proud, <span class="accent">Mancunian</span>',
    emoji: '🎸',
    theme: 'culture',
    accentColor: '#cc88ff',
    accentColor2: '#ff66cc',
    scene3d: 'neon',
    intro: `You can't understand Manchester without understanding its music. The Smiths. Joy Division. New Order. Oasis. The Stone Roses. The Courteeners. Each era producing a sound so distinct, so emotionally charged, it echoed across the world. And beyond music — art, architecture, nightlife, football, and an unshakeable Mancunian identity.`,
    rainbow: '🎵 The City That Defined Cool',
    quote: { text: `"Manchester has everything except a beach."`, author: '— Ian Brown, The Stone Roses' },
    cards: [
      { emoji: '🎵', value: '1978', label: 'Factory Records', desc: 'Tony Wilson launches Factory Records — Joy Division, New Order, the Haçienda' },
      { emoji: '🏠', value: '1982', label: 'The Haçienda', desc: 'The most famous nightclub in history — birthplace of Madchester & rave culture' },
      { emoji: '🎤', value: 'Oasis', label: 'Knebworth 1996', desc: '2.5 million applications for 250,000 tickets — the biggest concert demand ever' },
      { emoji: '🎭', value: '200+', label: 'Live Venues', desc: 'Manchester\'s live music scene is the most active outside of London' },
      { emoji: '🖼️', value: '1824', label: 'Art Gallery', desc: 'Manchester Art Gallery holds one of the finest pre-Raphaelite collections' },
      { emoji: '🌈', value: 'Canal St', label: 'The Village', desc: 'Manchester\'s LGBTQ+ Village — the most vibrant and inclusive in Europe' }
    ],
    timeline: [
      { year: '1976', text: 'Sex Pistols play Manchester Free Trade Hall — punk ignites the city.' },
      { year: '1978', text: 'Joy Division debut. Post-punk\'s most haunting sound is born.' },
      { year: '1982', text: 'The Haçienda opens. Music history begins on Whitworth St.' },
      { year: '1989', text: 'The Stone Roses debut album — the soundtrack of a generation.' },
      { year: '1994', text: 'Oasis: Definitely Maybe. Manchester rock goes worldwide.' },
      { year: '2025', text: 'Oasis Reunion — 30 years on, Manchester still writes the setlist.' }
    ],
    tags: [
      { text: '🎵 Madchester', col: '#cc88ff' },
      { text: '🎸 Oasis', col: '#ff66cc' },
      { text: '🏠 The Haçienda', col: '#cc88ff' },
      { text: '📼 Factory Records', col: '#ff66cc' },
      { text: '🌃 Nightlife', col: '#aa66ff' }
    ],
    progress: [
      { name: 'Live Music Venues (UK rank)', pct: 88, val: '2nd' },
      { name: 'Cultural Contribution to GDP', pct: 72, val: '£1.6B' },
      { name: 'Music Festivals Per Year', pct: 80, val: '50+' },
      { name: 'Arts & Culture Employment', pct: 65, val: '65K+' }
    ]
  }
};

// ═══════════════════════════════════════════════════════════════
// EMOJI BURST EFFECT
// ═══════════════════════════════════════════════════════════════
function spawnEmojisBurst(x, y, emojis) {
  emojis.forEach((em, i) => {
    const el = document.createElement('div');
    el.className = 'emoji-burst';
    el.textContent = em;
    const angle = (i / emojis.length) * Math.PI * 2;
    const dist = 60 + Math.random() * 60;
    el.style.cssText = `
      left: ${x}px; top: ${y}px;
      --dx: ${Math.cos(angle) * dist}px;
      --dy: ${Math.sin(angle) * dist - 80}px;
      animation-delay: ${i * 0.05}s;
    `;
    document.body.appendChild(el);
    setTimeout(() => el.remove(), 1400);
  });
}

// ═══════════════════════════════════════════════════════════════
// MINI 3D SCENE BUILDERS
// ═══════════════════════════════════════════════════════════════
const miniScenes = {};

function buildMiniScene(canvas, type, accentHex) {
  if (!window.THREE) return;
  const scene = new THREE.Scene();
  const cam = new THREE.PerspectiveCamera(60, canvas.offsetWidth / canvas.offsetHeight, 0.1, 200);
  const ren = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: true });
  ren.setPixelRatio(Math.min(window.devicePixelRatio, 2));
  ren.setSize(canvas.offsetWidth, canvas.offsetHeight);
  ren.setClearColor(0x000000, 0);
  ren.toneMapping = THREE.ACESFilmicToneMapping;

  const accentColor = new THREE.Color(accentHex);
  let animId;

  if (type === 'city') {
    cam.position.set(0, 8, 20);
    const ambient = new THREE.AmbientLight(0x111133, 3);
    scene.add(ambient);
    const pt = new THREE.PointLight(accentHex, 4, 50);
    pt.position.set(0, 15, 0);
    scene.add(pt);
    for (let i = -5; i <= 5; i++) {
      const h = 3 + Math.random() * 10;
      const geo = new THREE.BoxGeometry(1.2, h, 1.2);
      const mat = new THREE.MeshStandardMaterial({ color: 0x0d1a2e, emissive: new THREE.Color(accentHex).multiplyScalar(0.08), roughness: 0.4, metalness: 0.8 });
      const m = new THREE.Mesh(geo, mat);
      m.position.set(i * 2.5, h / 2 - 2, -(Math.random() * 5 + 3));
      scene.add(m);
    }
    const floor = new THREE.Mesh(new THREE.PlaneGeometry(100, 100), new THREE.MeshStandardMaterial({ color: 0x050810, roughness: 0.1, metalness: 0.9 }));
    floor.rotation.x = -Math.PI / 2; floor.position.y = -2;
    scene.add(floor);
    let t = 0;
    function anim() { animId = requestAnimationFrame(anim); t += 0.008; cam.position.x = Math.sin(t) * 6; cam.lookAt(0, 4, 0); ren.render(scene, cam); }
    anim();
  }
  else if (type === 'factory') {
    cam.position.set(0, 5, 18);
    scene.fog = new THREE.FogExp2(0x1a0800, 0.03);
    const hemi = new THREE.HemisphereLight(0xff6600, 0x220000, 2);
    scene.add(hemi);
    for (let i = -3; i <= 3; i++) {
      const h = 5 + Math.random() * 7;
      const geo = new THREE.BoxGeometry(2.5, h, 2);
      const mat = new THREE.MeshStandardMaterial({ color: 0x1a0800, roughness: 1, emissive: 0x200800, emissiveIntensity: 0.3 });
      const m = new THREE.Mesh(geo, mat);
      m.position.set(i * 4, h / 2 - 2, -(Math.random() * 3 + 2));
      scene.add(m);
      // Chimneys
      const cGeo = new THREE.CylinderGeometry(0.15, 0.2, 5);
      const ch = new THREE.Mesh(cGeo, new THREE.MeshStandardMaterial({ color: 0x111111 }));
      ch.position.set(i * 4, m.position.y + h / 2 + 2.5, m.position.z);
      scene.add(ch);
      const glow = new THREE.PointLight(accentHex, 2, 8);
      glow.position.set(i * 4, ch.position.y + 3, ch.position.z);
      scene.add(glow);
    }
    const floor = new THREE.Mesh(new THREE.PlaneGeometry(100, 100), new THREE.MeshStandardMaterial({ color: 0x0a0400 }));
    floor.rotation.x = -Math.PI / 2; floor.position.y = -2;
    scene.add(floor);
    let t = 0;
    function anim() { animId = requestAnimationFrame(anim); t += 0.007; cam.position.x = Math.sin(t * 0.5) * 5; cam.lookAt(0, 3, 0); ren.render(scene, cam); }
    anim();
  }
  else if (type === 'network') {
    cam.position.set(0, 0, 20);
    const ambient = new THREE.AmbientLight(0x001030, 3);
    scene.add(ambient);
    const nodes = [];
    for (let i = 0; i < 15; i++) {
      const geo = new THREE.SphereGeometry(0.25, 8, 8);
      const mat = new THREE.MeshBasicMaterial({ color: accentHex });
      const m = new THREE.Mesh(geo, mat);
      m.position.set((Math.random() - 0.5) * 20, (Math.random() - 0.5) * 10, (Math.random() - 0.5) * 5);
      scene.add(m);
      nodes.push(m);
      const pl = new THREE.PointLight(accentHex, 1, 5);
      pl.position.copy(m.position);
      scene.add(pl);
    }
    // Connections
    for (let i = 0; i < 20; i++) {
      const a = nodes[Math.floor(Math.random() * nodes.length)];
      const b = nodes[Math.floor(Math.random() * nodes.length)];
      const pts = [a.position.clone(), b.position.clone()];
      const geo = new THREE.BufferGeometry().setFromPoints(pts);
      const mat = new THREE.LineBasicMaterial({ color: accentHex, transparent: true, opacity: 0.2 });
      scene.add(new THREE.Line(geo, mat));
    }
    let t = 0;
    function anim() { animId = requestAnimationFrame(anim); t += 0.01; cam.position.x = Math.sin(t * 0.3) * 3; cam.position.y = Math.cos(t * 0.2) * 2; cam.lookAt(0, 0, 0); nodes.forEach((n, i) => { n.position.y += Math.sin(t + i) * 0.005; }); ren.render(scene, cam); }
    anim();
  }
  else if (type === 'atoms') {
    cam.position.set(0, 0, 14);
    const ambient = new THREE.AmbientLight(0x001a10, 3);
    scene.add(ambient);
    // Nucleus
    const nucl = new THREE.Mesh(new THREE.SphereGeometry(0.8, 16, 16), new THREE.MeshBasicMaterial({ color: accentHex }));
    scene.add(nucl);
    const nucleusGlow = new THREE.PointLight(accentHex, 4, 15);
    scene.add(nucleusGlow);
    // Electron orbits
    const electrons = [];
    for (let i = 0; i < 3; i++) {
      const r = 2.5 + i * 1.2;
      const orbitGeo = new THREE.TorusGeometry(r, 0.03, 8, 64);
      const orbitMat = new THREE.MeshBasicMaterial({ color: accentHex, transparent: true, opacity: 0.15 });
      const orbit = new THREE.Mesh(orbitGeo, orbitMat);
      orbit.rotation.x = (i / 3) * Math.PI;
      orbit.rotation.y = (i / 3) * Math.PI * 0.7;
      scene.add(orbit);
      const eSphere = new THREE.Mesh(new THREE.SphereGeometry(0.15, 8, 8), new THREE.MeshBasicMaterial({ color: '#ffffff' }));
      scene.add(eSphere);
      electrons.push({ mesh: eSphere, radius: r, speed: 0.8 + i * 0.4, phase: (i / 3) * Math.PI * 2, tiltX: (i / 3) * Math.PI, tiltY: (i / 3) * Math.PI * 0.7 });
    }
    let t = 0;
    function anim() {
      animId = requestAnimationFrame(anim); t += 0.02;
      electrons.forEach(e => {
        const ang = t * e.speed + e.phase;
        const x = Math.cos(ang) * e.radius;
        const y = Math.sin(ang) * e.radius * Math.cos(e.tiltX);
        const z = Math.sin(ang) * e.radius * Math.sin(e.tiltX);
        e.mesh.position.set(x, y, z);
      });
      cam.position.x = Math.sin(t * 0.3) * 2;
      cam.lookAt(0, 0, 0);
      ren.render(scene, cam);
    }
    anim();
  }
  else if (type === 'stadium') {
    cam.position.set(0, 20, 35);
    const ambient = new THREE.AmbientLight(0x111122, 3);
    scene.add(ambient);
    // Pitch
    const pitch = new THREE.Mesh(new THREE.PlaneGeometry(30, 20), new THREE.MeshStandardMaterial({ color: 0x1a5c1a, roughness: 0.8 }));
    pitch.rotation.x = -Math.PI / 2; pitch.position.y = -2;
    scene.add(pitch);
    // Lines
    const lineMat = new THREE.LineBasicMaterial({ color: 0xffffff, transparent: true, opacity: 0.5 });
    [[0, -10, 0, 10], [-15, -10, -15, 10], [15, -10, 15, 10]].forEach(([x1, z1, x2, z2]) => {
      const g = new THREE.BufferGeometry().setFromPoints([new THREE.Vector3(x1, -1.99, z1), new THREE.Vector3(x2, -1.99, z2)]);
      scene.add(new THREE.Line(g, lineMat));
    });
    // Stands
    [[0, -12, 0, 30, 4], [0, 12, Math.PI, 30, 4], [-16, 0, Math.PI / 2, 4, 20], [16, 0, -Math.PI / 2, 4, 20]].forEach(([x, z, ry, w, d]) => {
      const geo = new THREE.BoxGeometry(w, 6, d);
      const mat = new THREE.MeshStandardMaterial({ color: 0x1a1a2e, emissive: 0x0a0a1a, emissiveIntensity: 0.4 });
      const m = new THREE.Mesh(geo, mat);
      m.position.set(x, 0, z); m.rotation.y = ry;
      scene.add(m);
    });
    // Floodlights
    [[12, 10], [-12, 10], [12, -10], [-12, -10]].forEach(([x, z]) => {
      const pl = new THREE.SpotLight(0xffffee, 30, 60, 0.6, 0.3);
      pl.position.set(x, 14, z); pl.target.position.set(0, 0, 0);
      scene.add(pl); scene.add(pl.target);
    });
    let t = 0;
    function anim() { animId = requestAnimationFrame(anim); t += 0.006; cam.position.x = Math.sin(t) * 8; cam.lookAt(0, 0, 0); ren.render(scene, cam); }
    anim();
  }
  else if (type === 'neon') {
    cam.position.set(0, 3, 16);
    scene.fog = new THREE.FogExp2(0x060010, 0.04);
    const ambient = new THREE.AmbientLight(0x110033, 4);
    scene.add(ambient);
    const neonCols = [0xff00ff, 0x00ffff, 0xff6600, 0xcc00ff, 0x00ff88];
    for (let i = -4; i <= 4; i++) {
      const h = 4 + Math.random() * 8;
      const col = neonCols[Math.abs(i) % neonCols.length];
      const geo = new THREE.BoxGeometry(1.5, h, 1.2);
      const mat = new THREE.MeshStandardMaterial({ color: 0x0a0010, emissive: new THREE.Color(col).multiplyScalar(0.08) });
      const m = new THREE.Mesh(geo, mat);
      m.position.set(i * 2.8, h / 2 - 2, -(Math.random() * 4 + 2));
      scene.add(m);
      const edge = new THREE.EdgesGeometry(geo);
      const lineMat = new THREE.LineBasicMaterial({ color: col, transparent: true, opacity: 0.5 });
      const lines = new THREE.LineSegments(edge, lineMat);
      lines.position.copy(m.position);
      scene.add(lines);
      const pl = new THREE.PointLight(col, 1.5, 8);
      pl.position.set(i * 2.8, h - 1, m.position.z);
      scene.add(pl);
    }
    const floor = new THREE.Mesh(new THREE.PlaneGeometry(100, 100), new THREE.MeshStandardMaterial({ color: 0x050010, roughness: 0.05, metalness: 1 }));
    floor.rotation.x = -Math.PI / 2; floor.position.y = -2;
    scene.add(floor);
    let t = 0;
    const lights = scene.children.filter(c => c.isPointLight);
    function anim() {
      animId = requestAnimationFrame(anim); t += 0.012;
      lights.forEach((l, i) => { l.intensity = 1.2 + Math.sin(t * 2 + i) * 0.8; });
      cam.position.x = Math.sin(t * 0.4) * 4;
      cam.lookAt(0, 3, 0);
      ren.render(scene, cam);
    }
    anim();
  }

  return { ren, animId: () => animId };
}

// ═══════════════════════════════════════════════════════════════
// OPEN MODAL
// ═══════════════════════════════════════════════════════════════
let currentMiniScene = null;

function openModal(key, btnEl) {
  const data = MODALS[key];
  if (!data) return;

  // Emoji burst from button
  const rect = btnEl.getBoundingClientRect();
  const cx = rect.left + rect.width / 2;
  const cy = rect.top + rect.height / 2;
  const burstEmojis = [data.emoji, '✨', '💫', '⚡', '🌟', '💥'];
  spawnEmojisBurst(cx, cy, burstEmojis);

  // Build cards HTML
  const cardsHTML = data.cards.map((c, i) => `
    <div class="modal-card" style="transition-delay:${0.1 + i * 0.07}s">
      <span class="modal-card-emoji">${c.emoji}</span>
      <div class="modal-card-value">${c.value}</div>
      <div class="modal-card-label">${c.label}</div>
      <div class="modal-card-desc">${c.desc}</div>
    </div>
  `).join('');

  const timelineHTML = data.timeline.map((t, i) => `
    <div class="timeline-item" style="transition-delay:${0.15 + i * 0.08}s">
      <div class="timeline-year">${t.year}</div>
      <div class="timeline-text">${t.text}</div>
    </div>
  `).join('');

  const tagsHTML = data.tags.map(t => `
    <span class="modal-tag" style="color:${t.col};border-color:${t.col};background:${t.col}11">${t.text}</span>
  `).join('');

  const progressHTML = data.progress.map(p => `
    <div class="progress-item">
      <div class="progress-label-row">
        <span class="progress-name">${p.name}</span>
        <span class="progress-value">${p.val}</span>
      </div>
      <div class="progress-track">
        <div class="progress-fill" data-pct="${p.pct}" style="--accent-col:${data.accentColor};--accent-col2:${data.accentColor2}"></div>
      </div>
    </div>
  `).join('');

  const inner = document.getElementById('modal-inner');
  inner.innerHTML = `
    <div data-modal="${data.theme}" style="--accent-col:${data.accentColor};--accent-col2:${data.accentColor2}">
      <!-- HEADER -->
      <div class="modal-header">
        <div class="modal-header-bg">
          <canvas class="modal-header-canvas" id="mini-3d-canvas" width="880" height="220"></canvas>
        </div>
        <div class="modal-header-overlay"></div>
        <div class="modal-header-content">
          <span class="modal-emoji-big">${data.emoji}</span>
          <span class="modal-eyebrow" style="color:${data.accentColor}">${data.eyebrow}</span>
          <div class="modal-title" style="--accent-col:${data.accentColor}">${data.title}</div>
        </div>
      </div>

      <!-- BODY -->
      <div class="modal-body">
        <!-- INTRO -->
        <p class="modal-intro" style="border-color:${data.accentColor}">${data.intro}</p>

        <!-- QUOTE -->
        <div class="modal-quote" style="border-color:${data.accentColor}">
          ${data.quote.text}
          <div class="modal-quote-author" style="color:${data.accentColor}">${data.quote.author}</div>
        </div>

        <!-- RAINBOW TITLE -->
        <div class="modal-rainbow-title">${data.rainbow}</div>

        <!-- FACT CARDS -->
        <div class="modal-cards">${cardsHTML}</div>

        <!-- DIVIDER -->
        <div class="modal-divider"></div>

        <!-- PROGRESS BARS -->
        <div class="modal-progress-list">${progressHTML}</div>

        <!-- DIVIDER -->
        <div class="modal-divider"></div>

        <!-- TIMELINE -->
        <div class="modal-timeline">${timelineHTML}</div>

        <!-- TAGS -->
        <div class="modal-tags">${tagsHTML}</div>
      </div>
    </div>
  `;

  // Set modal accent line
  const box = document.getElementById('modal-box');
  box.style.setProperty('--modal-accent', `linear-gradient(90deg, ${data.accentColor}, ${data.accentColor2})`);

  // Show overlay
  const overlay = document.getElementById('modal-overlay');
  overlay.classList.add('active');
  document.body.style.overflow = 'hidden';

  // Build mini 3D scene
  setTimeout(() => {
    const miniCanvas = document.getElementById('mini-3d-canvas');
    if (miniCanvas && window.THREE) {
      if (currentMiniScene) {
        // stop old scene
        currentMiniScene = null;
      }
      currentMiniScene = buildMiniScene(miniCanvas, data.scene3d, data.accentColor);
    }

    // Animate cards in
    document.querySelectorAll('.modal-card').forEach(c => {
      setTimeout(() => c.classList.add('visible'), 50);
    });
    document.querySelectorAll('.timeline-item').forEach(c => {
      setTimeout(() => c.classList.add('visible'), 50);
    });

    // Animate progress bars
    document.querySelectorAll('.progress-fill').forEach(p => {
      const pct = p.dataset.pct;
      setTimeout(() => { p.style.width = pct + '%'; }, 300);
    });
  }, 300);
}

// ═══════════════════════════════════════════════════════════════
// CLOSE MODAL
// ═══════════════════════════════════════════════════════════════
function closeModal() {
  const overlay = document.getElementById('modal-overlay');
  const box = document.getElementById('modal-box');
  box.style.opacity = '0';
  box.style.transform = 'scale(0.9) translateY(20px)';
  setTimeout(() => {
    overlay.classList.remove('active');
    document.body.style.overflow = '';
    box.style.opacity = '';
    box.style.transform = '';
    box.scrollTop = 0;
  }, 400);
}

document.getElementById('modal-close').addEventListener('click', closeModal);
document.getElementById('modal-overlay').addEventListener('click', function(e) {
  if (e.target === this) closeModal();
});
document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });


</script>
</body>
</html>
